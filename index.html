<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ù–æ–æ–∫–∞—Ç –ù–æ–≤–æ—Å—Ç–∏ - –ñ–∞“£—ã–ª—ã–∫—Ç–∞—Ä | Nookat News</title>
  <meta name="description" content="–ù–æ–æ–∫–∞—Ç –ù–æ–≤–æ—Å—Ç–∏ - –≥–ª–∞–≤–Ω—ã–π –ø–æ—Ä—Ç–∞–ª –ù–æ–æ–∫–∞—Ç—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞. –ù–æ–≤–æ—Å—Ç–∏, —Ä—ã–Ω–æ–∫, –≤–∞–∫–∞–Ω—Å–∏–∏. –ù–æ–æ–∫–∞—Ç –∂–∞“£—ã–ª—ã–∫—Ç–∞—Ä—ã.">
  <meta name="keywords" content="–Ω–æ–æ–∫–∞—Ç –Ω–æ–≤–æ—Å—Ç–∏, –Ω–æ–æ–∫–∞—Ç –∂–∞“£—ã–ª—ã–∫—Ç–∞—Ä—ã, nookat news, —Ä—ã–Ω–æ–∫ –Ω–æ–æ–∫–∞—Ç, –≤–∞–∫–∞–Ω—Å–∏–∏ –Ω–æ–æ–∫–∞—Ç">
  <meta property="og:title" content="–ù–æ–æ–∫–∞—Ç –ù–æ–≤–æ—Å—Ç–∏ - Nookat News">
  <meta property="og:description" content="–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏, —Ä—ã–Ω–æ–∫ –∏ –≤–∞–∫–∞–Ω—Å–∏–∏ –ù–æ–æ–∫–∞—Ç—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞">
  <meta property="og:url" content="https://nookat.c6t.ru">
  <meta property="og:image" content="https://nookat.c6t.ru/images/nookatday.jpg">
  <meta name="robots" content="index, follow">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --primary:#2563eb;--primary-light:#3b82f6;--primary-dark:#1d4ed8;
      --bg:#f0f4ff;--card:#fff;--text:#0f172a;--text2:#64748b;
      --border:#e2e8f0;--success:#10b981;--danger:#ef4444;--warn:#f59e0b;
      --purple:#7c3aed;--orange:#f97316;
      --shadow:0 1px 15px rgba(0,0,0,.06);--shadow2:0 4px 30px rgba(0,0,0,.1);
      --radius:16px;--radius-sm:10px;
    }
    body{font-family:'Nunito',sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;padding-bottom:80px}
    body.dark{--bg:#0b0f1a;--card:#141926;--text:#f1f5f9;--text2:#94a3b8;--border:#1e293b;--shadow:0 1px 15px rgba(0,0,0,.3)}

    /* –®–ê–ü–ö–ê */
    header{background:rgba(255,255,255,.95);backdrop-filter:blur(20px);position:sticky;top:0;z-index:500;border-bottom:1px solid var(--border);box-shadow:var(--shadow)}
    body.dark header{background:rgba(20,25,38,.95)}
    .header-inner{max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .logo{display:flex;align-items:center;gap:10px;cursor:pointer;flex-shrink:0}
    .logo-avatar{width:42px;height:42px;border-radius:50%;object-fit:cover;border:2.5px solid var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.15)}
    .logo-text h1{font-size:1.05rem;font-weight:900;color:var(--primary);line-height:1}
    .logo-text span{font-size:.68rem;color:var(--text2);font-weight:600}
    .header-right{display:flex;align-items:center;gap:8px}
    .lang-sw{display:flex;background:var(--bg);border-radius:20px;padding:3px;gap:2px}
    .lang-sw button{background:none;border:none;padding:5px 11px;border-radius:15px;cursor:pointer;font-weight:700;font-size:.8rem;color:var(--text2);font-family:inherit;transition:.2s}
    .lang-sw button.on{background:var(--primary);color:#fff}
    .icon-btn{width:36px;height:36px;border-radius:50%;border:none;background:var(--bg);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1rem;transition:.2s;color:var(--text)}
    .icon-btn:hover{background:var(--primary);color:#fff}
    .auth-btns{display:flex;gap:6px}
    .btn-login{padding:7px 14px;border:2px solid var(--primary);background:none;color:var(--primary);border-radius:20px;cursor:pointer;font-weight:700;font-size:.82rem;font-family:inherit;transition:.2s}
    .btn-login:hover{background:var(--primary);color:#fff}
    .btn-reg{padding:7px 14px;background:var(--primary);color:#fff;border:none;border-radius:20px;cursor:pointer;font-weight:700;font-size:.82rem;font-family:inherit;transition:.2s}
    .btn-reg:hover{background:var(--primary-dark)}
    .user-avatar-btn{width:36px;height:36px;border-radius:50%;object-fit:cover;cursor:pointer;border:2px solid var(--primary);display:none}

    /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
    nav{background:var(--card);border-bottom:1px solid var(--border)}
    .nav-inner{max-width:1100px;margin:0 auto;display:flex;overflow-x:auto;scrollbar-width:none;padding:0 16px}
    .nav-inner::-webkit-scrollbar{display:none}
    .nav-tab{padding:13px 18px;border:none;background:none;cursor:pointer;font-weight:700;font-size:.88rem;color:var(--text2);white-space:nowrap;border-bottom:3px solid transparent;transition:.2s;display:flex;align-items:center;gap:6px;font-family:inherit}
    .nav-tab:hover{color:var(--primary)}
    .nav-tab.on{color:var(--primary);border-bottom-color:var(--primary)}

    /* –ö–û–ù–¢–ï–ô–ù–ï–† */
    .container{max-width:1100px;margin:0 auto;padding:20px 16px}
    .section{display:none;animation:fadeUp .3s ease}
    .section.on{display:block}
    @keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

    /* –ö–ê–†–¢–û–ß–ö–ò –ù–û–í–û–°–¢–ï–ô */
    .news-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:18px}
    .news-card{background:var(--card);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);transition:.3s;position:relative}
    .news-card:hover{transform:translateY(-4px);box-shadow:var(--shadow2)}
    .news-card-img{width:100%;height:190px;object-fit:cover;display:block;background:var(--bg)}
    .news-card-body{padding:15px}
    .news-card-meta{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .news-card-date{font-size:.75rem;color:var(--text2);font-weight:600}
    .news-card-badge{font-size:.68rem;font-weight:800;background:var(--primary);color:#fff;padding:3px 9px;border-radius:10px}
    .news-card h3{font-size:1rem;font-weight:800;margin-bottom:7px;line-height:1.4;cursor:pointer}
    .news-card h3:hover{color:var(--primary)}
    .news-card-text{font-size:.85rem;color:var(--text2);margin-bottom:12px;line-height:1.5}
    .news-card-footer{display:flex;align-items:center;justify-content:space-between}
    .reactions{display:flex;gap:4px}
    .reaction-btn{background:var(--bg);border:none;padding:5px 9px;border-radius:20px;cursor:pointer;font-size:.82rem;display:flex;align-items:center;gap:4px;color:var(--text2);font-weight:600;transition:.2s;font-family:inherit}
    .reaction-btn:hover,.reaction-btn.active{background:var(--primary);color:#fff}
    .post-stats{display:flex;align-items:center;gap:10px;font-size:.78rem;color:var(--text2)}
    .post-stats i{font-size:.75rem}
    .three-dots{position:absolute;top:10px;right:10px;width:30px;height:30px;border-radius:50%;background:rgba(0,0,0,.45);border:none;cursor:pointer;color:#fff;display:flex;align-items:center;justify-content:center;font-size:.9rem}
    .three-dots:hover{background:rgba(0,0,0,.7)}

    /* DROPDOWN */
    .dropdown{position:absolute;top:44px;right:10px;background:var(--card);border-radius:12px;box-shadow:var(--shadow2);z-index:100;min-width:170px;overflow:hidden;display:none;border:1px solid var(--border)}
    .dropdown.show{display:block;animation:fadeUp .2s ease}
    .dropdown-item{padding:11px 16px;display:flex;align-items:center;gap:10px;cursor:pointer;font-size:.88rem;font-weight:600;transition:.15s}
    .dropdown-item:hover{background:var(--bg)}
    .dropdown-item.red{color:var(--danger)}
    .dropdown-item.red:hover{background:#fef2f2}

    /* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(6px);z-index:1000;display:none;align-items:center;justify-content:center;padding:16px}
    .overlay.show{display:flex;animation:fadeUp .25s ease}
    .modal{background:var(--card);border-radius:20px;width:100%;max-width:480px;max-height:92vh;overflow-y:auto;position:relative;box-shadow:var(--shadow2)}
    .modal-lg{max-width:700px}
    .modal-header{padding:20px 20px 0;display:flex;align-items:center;justify-content:space-between}
    .modal-header h2{font-size:1.3rem;font-weight:900}
    .close-btn{width:32px;height:32px;border-radius:50%;border:none;background:var(--bg);cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;color:var(--text);transition:.2s}
    .close-btn:hover{background:var(--danger);color:#fff}
    .modal-body{padding:20px}

    /* –§–û–†–ú–ê */
    .form-group{margin-bottom:14px}
    .form-group label{display:block;font-weight:700;font-size:.85rem;margin-bottom:6px;color:var(--text)}
    .form-input,.form-textarea,.form-select{width:100%;padding:11px 14px;border:2px solid var(--border);border-radius:11px;font-size:.9rem;font-family:inherit;background:var(--card);color:var(--text);transition:.2s}
    .form-input:focus,.form-textarea:focus,.form-select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
    .form-textarea{resize:vertical;min-height:90px}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .file-drop{border:2px dashed var(--border);border-radius:11px;padding:20px;text-align:center;cursor:pointer;transition:.2s;position:relative;background:var(--bg)}
    .file-drop:hover{border-color:var(--primary);background:rgba(37,99,235,.04)}
    .file-drop input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
    .file-drop-icon{font-size:2rem;color:var(--text2);margin-bottom:6px}
    .file-drop p{font-size:.85rem;color:var(--text2);font-weight:600}
    .img-preview{width:100%;border-radius:10px;margin-top:10px;display:none;max-height:220px;object-fit:cover}
    .btn-full{width:100%;padding:13px;background:var(--primary);color:#fff;border:none;border-radius:12px;font-weight:800;font-size:.95rem;cursor:pointer;font-family:inherit;transition:.2s}
    .btn-full:hover{background:var(--primary-dark)}
    .btn-full:disabled{opacity:.6;cursor:not-allowed}
    .btn-secondary-full{width:100%;padding:11px;background:var(--bg);color:var(--text);border:2px solid var(--border);border-radius:12px;font-weight:700;font-size:.9rem;cursor:pointer;font-family:inherit;transition:.2s;margin-top:8px}
    .btn-secondary-full:hover{border-color:var(--primary);color:var(--primary)}
    .divider{display:flex;align-items:center;gap:12px;margin:16px 0;color:var(--text2);font-size:.82rem;font-weight:600}
    .divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border)}
    .social-auth{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .social-btn{padding:11px;border:2px solid var(--border);background:var(--card);border-radius:11px;cursor:pointer;font-weight:700;font-size:.85rem;display:flex;align-items:center;justify-content:center;gap:8px;font-family:inherit;transition:.2s;color:var(--text)}
    .social-btn:hover{border-color:var(--primary)}
    .switch-link{text-align:center;margin-top:14px;font-size:.85rem;color:var(--text2)}
    .switch-link a{color:var(--primary);cursor:pointer;font-weight:700}
    .error-msg{color:var(--danger);font-size:.8rem;margin-top:5px;display:none}
    .phone-row{display:flex;gap:8px}
    .country-code{width:80px;flex-shrink:0}
    .strength-bar{height:4px;border-radius:2px;background:var(--border);margin-top:6px;overflow:hidden}
    .strength-fill{height:100%;border-radius:2px;transition:.3s;width:0}
    .avatar-upload{display:flex;align-items:center;gap:14px;margin-bottom:14px}
    .avatar-preview-circle{width:64px;height:64px;border-radius:50%;object-fit:cover;border:2px solid var(--border);background:var(--bg)}
    .avatar-upload-btn{padding:8px 16px;background:var(--bg);border:2px solid var(--border);border-radius:10px;cursor:pointer;font-weight:700;font-size:.82rem;font-family:inherit;position:relative;overflow:hidden;color:var(--text)}
    .avatar-upload-btn input{position:absolute;inset:0;opacity:0;cursor:pointer}

    /* –†–´–ù–û–ö */
    .market-cats{display:flex;gap:8px;overflow-x:auto;scrollbar-width:none;padding-bottom:4px;margin-bottom:18px}
    .market-cats::-webkit-scrollbar{display:none}
    .cat-btn{padding:9px 18px;border:2px solid var(--border);background:var(--card);border-radius:25px;cursor:pointer;font-weight:700;font-size:.85rem;white-space:nowrap;font-family:inherit;color:var(--text);transition:.2s;display:flex;align-items:center;gap:6px}
    .cat-btn:hover{border-color:var(--primary);color:var(--primary)}
    .cat-btn.on{background:var(--primary);color:#fff;border-color:var(--primary)}
    .market-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px}
    .market-card{background:var(--card);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);transition:.3s;cursor:pointer;position:relative}
    .market-card:hover{transform:translateY(-3px);box-shadow:var(--shadow2)}
    .market-card-img{width:100%;height:180px;object-fit:cover;background:var(--bg)}
    .market-card-body{padding:13px}
    .market-card-price{font-size:1.15rem;font-weight:900;color:var(--primary);margin-bottom:4px}
    .market-card-title{font-size:.9rem;font-weight:700;margin-bottom:6px}
    .market-card-loc{font-size:.78rem;color:var(--text2);display:flex;align-items:center;gap:4px}
    .market-card-foot{display:flex;align-items:center;justify-content:space-between;margin-top:10px;padding-top:10px;border-top:1px solid var(--border)}
    .market-card-seller{display:flex;align-items:center;gap:6px;font-size:.78rem;color:var(--text2);font-weight:600}
    .seller-ava{width:22px;height:22px;border-radius:50%;object-fit:cover;background:var(--border)}

    /* –í–ê–ö–ê–ù–°–ò–ò */
    .jobs-list{display:flex;flex-direction:column;gap:14px}
    .job-card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);transition:.3s;cursor:pointer;position:relative}
    .job-card:hover{transform:translateY(-2px);box-shadow:var(--shadow2)}
    .job-header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:10px}
    .job-title{font-size:1.05rem;font-weight:800}
    .job-salary{font-size:1rem;font-weight:900;color:var(--success);white-space:nowrap}
    .job-company{font-size:.85rem;color:var(--text2);font-weight:600;margin-bottom:8px}
    .job-tags{display:flex;gap:6px;flex-wrap:wrap}
    .job-tag{padding:4px 10px;background:var(--bg);border-radius:10px;font-size:.75rem;font-weight:700;color:var(--text2)}
    .job-foot{display:flex;align-items:center;justify-content:space-between;margin-top:12px;padding-top:12px;border-top:1px solid var(--border)}
    .job-date{font-size:.75rem;color:var(--text2)}

    /* –û –ì–û–†–û–î–ï / –ö–û–ù–¢–ê–ö–¢–´ */
    .about-card{background:var(--card);border-radius:var(--radius);padding:24px;box-shadow:var(--shadow);margin-bottom:18px}
    .about-card h2{font-size:1.5rem;font-weight:900;color:var(--primary);margin-bottom:14px}
    .about-card p{color:var(--text2);line-height:1.8;margin-bottom:12px;font-size:.95rem}
    .contact-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .contact-item{background:var(--card);border-radius:var(--radius);padding:20px;text-align:center;box-shadow:var(--shadow);transition:.3s}
    .contact-item:hover{transform:translateY(-3px);box-shadow:var(--shadow2)}
    .contact-item-icon{font-size:2.2rem;margin-bottom:10px}
    .contact-item h4{font-size:.95rem;font-weight:800;margin-bottom:6px}
    .contact-item a{color:var(--primary);font-weight:700;font-size:.9rem;text-decoration:none}
    .contact-item a:hover{text-decoration:underline}
    .contact-item p{font-size:.8rem;color:var(--text2);margin-top:4px}

    /* –ü–†–û–§–ò–õ–¨ */
    .profile-header{background:linear-gradient(135deg,var(--primary),var(--purple));border-radius:var(--radius);padding:28px;text-align:center;color:#fff;margin-bottom:18px;box-shadow:var(--shadow2)}
    .profile-ava{width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid rgba(255,255,255,.5);margin:0 auto 12px;display:block}
    .profile-name{font-size:1.4rem;font-weight:900;margin-bottom:4px}
    .profile-email{font-size:.85rem;opacity:.8}
    .profile-tabs{display:flex;gap:6px;margin-bottom:18px}
    .profile-tab{padding:9px 18px;background:var(--card);border:2px solid var(--border);border-radius:20px;cursor:pointer;font-weight:700;font-size:.82rem;font-family:inherit;color:var(--text);transition:.2s}
    .profile-tab.on{background:var(--primary);color:#fff;border-color:var(--primary)}

    /* –ß–ê–¢ */
    .chat-layout{display:grid;grid-template-columns:280px 1fr;gap:16px;height:calc(100vh - 200px);max-height:600px}
    .chat-list{background:var(--card);border-radius:var(--radius);overflow-y:auto;box-shadow:var(--shadow)}
    .chat-list-header{padding:14px;border-bottom:1px solid var(--border);font-weight:800;font-size:.95rem}
    .chat-item{display:flex;align-items:center;gap:10px;padding:12px 14px;cursor:pointer;transition:.15s;border-bottom:1px solid var(--border)}
    .chat-item:hover,.chat-item.on{background:rgba(37,99,235,.06)}
    .chat-item-ava{width:40px;height:40px;border-radius:50%;object-fit:cover;background:var(--border);flex-shrink:0}
    .chat-item-info{flex:1;min-width:0}
    .chat-item-name{font-weight:700;font-size:.88rem}
    .chat-item-last{font-size:.76rem;color:var(--text2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .chat-item-time{font-size:.72rem;color:var(--text2)}
    .chat-window{background:var(--card);border-radius:var(--radius);display:flex;flex-direction:column;box-shadow:var(--shadow);overflow:hidden}
    .chat-win-header{padding:14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}
    .chat-win-header-ava{width:36px;height:36px;border-radius:50%;background:var(--border);flex-shrink:0}
    .chat-win-header-name{font-weight:800;font-size:.95rem}
    .chat-messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:10px;background:var(--bg)}
    .msg{max-width:72%;display:flex;flex-direction:column;gap:3px}
    .msg.mine{align-self:flex-end;align-items:flex-end}
    .msg.other{align-self:flex-start}
    .msg-bubble{padding:10px 14px;border-radius:16px;font-size:.88rem;line-height:1.5;word-break:break-word}
    .msg.mine .msg-bubble{background:var(--primary);color:#fff;border-bottom-right-radius:4px}
    .msg.other .msg-bubble{background:var(--card);border:1px solid var(--border);border-bottom-left-radius:4px}
    .msg-time{font-size:.68rem;color:var(--text2)}
    .msg-img{max-width:220px;border-radius:12px;cursor:pointer}
    .chat-input-area{padding:12px 14px;border-top:1px solid var(--border);display:flex;gap:8px;align-items:center}
    .chat-input{flex:1;padding:10px 14px;border:2px solid var(--border);border-radius:25px;font-size:.88rem;font-family:inherit;background:var(--bg);color:var(--text);transition:.2s}
    .chat-input:focus{outline:none;border-color:var(--primary)}
    .chat-send{width:40px;height:40px;border-radius:50%;background:var(--primary);border:none;cursor:pointer;color:#fff;display:flex;align-items:center;justify-content:center;font-size:1rem;transition:.2s}
    .chat-send:hover{background:var(--primary-dark)}
    .chat-attach{width:36px;height:36px;border-radius:50%;background:var(--bg);border:none;cursor:pointer;color:var(--text2);display:flex;align-items:center;justify-content:center;font-size:1rem;position:relative;overflow:hidden}
    .chat-attach input{position:absolute;inset:0;opacity:0;cursor:pointer}
    .chat-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:var(--text2);gap:10px}
    .chat-empty i{font-size:3rem;opacity:.3}

    /* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
    .toast{position:fixed;bottom:24px;right:24px;background:var(--card);padding:14px 18px;border-radius:12px;box-shadow:var(--shadow2);align-items:center;gap:10px;z-index:2000;font-weight:700;font-size:.88rem;max-width:340px;animation:fadeUp .3s ease;display:none}
    .toast.show{display:flex}
    .toast.ok{border-left:4px solid var(--success)}
    .toast.err{border-left:4px solid var(--danger)}
    .toast.warn{border-left:4px solid var(--warn)}

    /* FAB */
    .fab{position:fixed;bottom:28px;right:28px;width:52px;height:52px;border-radius:50%;background:var(--primary);color:#fff;border:none;cursor:pointer;font-size:1.4rem;box-shadow:0 4px 20px rgba(37,99,235,.4);z-index:400;display:flex;align-items:center;justify-content:center;transition:.3s}
    .fab:hover{transform:scale(1.1);background:var(--primary-dark)}

    /* –ö–ù–û–ü–ö–ê –ù–ê–í–ï–†–• */
    .scroll-up{position:fixed;bottom:90px;right:28px;width:40px;height:40px;border-radius:50%;background:var(--card);color:var(--primary);border:2px solid var(--primary);cursor:pointer;font-size:1rem;box-shadow:var(--shadow);z-index:399;display:none;align-items:center;justify-content:center;transition:.3s}
    .scroll-up.show{display:flex}
    .scroll-up:hover{background:var(--primary);color:#fff}

    /* –õ–û–ê–î–ï–† */
    .loader{text-align:center;padding:40px;color:var(--text2)}
    .spinner{width:38px;height:38px;border:3px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 12px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .empty{text-align:center;padding:50px;color:var(--text2)}
    .empty i{font-size:3rem;opacity:.3;margin-bottom:12px;display:block}

    /* –ü–û–ò–°–ö */
    .search-bar{display:flex;gap:8px;margin-bottom:18px}
    .search-bar input{flex:1;padding:11px 16px;border:2px solid var(--border);border-radius:12px;font-size:.9rem;font-family:inherit;background:var(--card);color:var(--text);transition:.2s}
    .search-bar input:focus{outline:none;border-color:var(--primary)}
    .search-bar button{padding:11px 18px;background:var(--primary);color:#fff;border:none;border-radius:12px;cursor:pointer;font-weight:700;font-family:inherit}

    /* –ü–û–°–¢ –î–ï–¢–ê–õ–ò */
    .post-contact-row{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--border);font-size:.9rem}
    .post-contact-row i{width:22px;color:var(--primary)}
    .post-contact-row a{color:var(--primary);font-weight:700;text-decoration:none}
    .open-chat-btn{width:100%;padding:12px;background:linear-gradient(135deg,var(--primary),var(--purple));color:#fff;border:none;border-radius:12px;font-weight:800;font-size:.95rem;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:8px;margin-top:14px;transition:.2s}
    .open-chat-btn:hover{opacity:.9}

    /* –ú–û–ò –ü–£–ë–õ–ò–ö–ê–¶–ò–ò */
    .my-posts-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:14px}
    .my-post-card{background:var(--card);border-radius:var(--radius-sm);padding:14px;box-shadow:var(--shadow);position:relative}
    .my-post-card-title{font-weight:800;font-size:.9rem;margin-bottom:6px}
    .my-post-card-type{font-size:.72rem;font-weight:700;padding:2px 8px;border-radius:8px;background:var(--bg);color:var(--text2);display:inline-block;margin-bottom:8px}
    .my-post-del{position:absolute;top:10px;right:10px;width:28px;height:28px;border-radius:50%;background:var(--bg);border:none;cursor:pointer;color:var(--danger);display:flex;align-items:center;justify-content:center;font-size:.85rem;transition:.2s}
    .my-post-del:hover{background:var(--danger);color:#fff}

    /* –ü–†–û–ì–†–ï–°–° –ó–ê–ì–†–£–ó–ö–ò */
    .upload-progress{background:var(--bg);border-radius:8px;padding:10px 14px;margin-bottom:10px;display:none}
    .upload-progress-bar{height:4px;background:var(--border);border-radius:2px;overflow:hidden;margin-top:6px}
    .upload-progress-fill{height:100%;background:var(--primary);border-radius:2px;transition:.3s;width:0}
    .upload-progress-text{font-size:.8rem;color:var(--text2);font-weight:600}

    /* –ê–î–ê–ü–¢–ò–í */
    @media(max-width:768px){
      .chat-layout{grid-template-columns:1fr;height:auto}
      .chat-list{display:none}.chat-list.show-mobile{display:block;height:260px}
      .news-grid{grid-template-columns:1fr}
      .market-grid{grid-template-columns:repeat(2,1fr)}
      .form-row{grid-template-columns:1fr}
      .social-auth{grid-template-columns:1fr}
      .logo-text span{display:none}
      .header-right .auth-btns .btn-login{display:none}
      .contact-grid{grid-template-columns:1fr 1fr}
      .fab{bottom:20px;right:20px;width:48px;height:48px}
      .scroll-up{bottom:80px;right:20px}
    }
    @media(max-width:480px){
      .market-grid{grid-template-columns:1fr}
      .contact-grid{grid-template-columns:1fr}
      .profile-tabs{flex-wrap:wrap}
    }

    /* ===== –ú–û–ë–ò–õ–¨–ù–´–ï –î–û–†–ê–ë–û–¢–ö–ò ===== */

/* –ß–∞—Ç ‚Äî –º–æ–±–∏–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ */
.chat-back-btn{display:none;background:none;border:none;color:var(--primary);font-weight:700;font-size:.9rem;cursor:pointer;padding:0 0 12px;font-family:inherit;align-items:center;gap:6px}

@media(max-width:768px){
  /* –ß–∞—Ç */
  .chat-back-btn{display:flex}
  .chat-layout{display:block;height:auto}
  .chat-list{display:block;height:auto;max-height:none;border-radius:var(--radius);margin-bottom:12px}
  .chat-window{min-height:420px;border-radius:var(--radius)}
  .chat-messages{min-height:280px;max-height:340px}
  .chat-list.hidden-mobile{display:none}
  .chat-window.hidden-mobile{display:none}

  /* –®–∞–ø–∫–∞ ‚Äî –º–µ–Ω—å—à–µ gap –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö */
  .header-inner{gap:6px;padding:8px 12px}
  .lang-sw button{padding:4px 8px;font-size:.75rem}
  .btn-reg{padding:6px 10px;font-size:.78rem}

  /* –ú–æ–¥–∞–ª–∫–∏ ‚Äî —É—á–∏—Ç—ã–≤–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É */
  .overlay{align-items:flex-start;padding-top:8px}
  .modal{max-height:95vh;border-radius:16px 16px 0 0;margin-top:auto}
  .overlay.show{display:flex;flex-direction:column;justify-content:flex-end}

  /* FAB –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç */
  body{padding-bottom:100px}

  /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ä—ã–Ω–∫–∞ –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö */
  .market-card-price{font-size:1rem}
  .market-card-title{font-size:.85rem}
}

@media(max-width:400px){
  .market-grid{grid-template-columns:1fr}
  .lang-sw{display:none} /* –ø—Ä—è—á–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –µ—Å–ª–∏ —Å–æ–≤—Å–µ–º –º–∞–ª–æ –º–µ—Å—Ç–∞ */
  .logo-text h1{font-size:.95rem}
}
  </style>
</head>
<body>

<!-- –®–ê–ü–ö–ê -->
<header>
  <div class="header-inner">
    <div class="logo" onclick="goTab('news')">
      <img src="images/nookatday.jpg" alt="Nookat" class="logo-avatar" id="logoAva">
      <div class="logo-text">
        <h1 data-ru="–ù–æ–æ–∫–∞—Ç –ù–æ–≤–æ—Å—Ç–∏" data-kg="–ù–æ–æ–∫–∞—Ç –ñ–∞“£—ã–ª—ã–∫—Ç–∞—Ä—ã">–ù–æ–æ–∫–∞—Ç –ù–æ–≤–æ—Å—Ç–∏</h1>
        <span data-ru="–ì–ª–∞–≤–Ω—ã–π –ø–æ—Ä—Ç–∞–ª —Ä–∞–π–æ–Ω–∞" data-kg="–†–∞–π–æ–Ω–¥—É–Ω –±–∞—à–∫—ã –ø–æ—Ä—Ç–∞–ª—ã">–ì–ª–∞–≤–Ω—ã–π –ø–æ—Ä—Ç–∞–ª —Ä–∞–π–æ–Ω–∞</span>
      </div>
    </div>
    <div class="header-right">
      <div class="lang-sw">
        <button data-lang="ru" class="on">RU</button>
        <button data-lang="kg">KG</button>
      </div>
      <button class="icon-btn" onclick="toggleTheme()" id="themeBtn" title="–¢–µ–º–∞">üåô</button>
      <div class="auth-btns" id="guestBtns">
        <button class="btn-login" onclick="openModal('loginModal')">–í–æ–π—Ç–∏</button>
        <button class="btn-reg" onclick="openModal('regModal')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
      </div>
      <img src="https://ui-avatars.com/api/?name=U&background=2563eb&color=fff"
           class="user-avatar-btn" id="userAvaBtn" onclick="handleAvaClick()" title="–ü—Ä–æ—Ñ–∏–ª—å">
    </div>
  </div>
  <nav>
    <div class="nav-inner">
      <button class="nav-tab on" data-tab="news" onclick="goTab('news')"><i class="fas fa-newspaper"></i> <span data-ru="–ù–æ–≤–æ—Å—Ç–∏" data-kg="–ñ–∞“£—ã–ª—ã–∫—Ç–∞—Ä">–ù–æ–≤–æ—Å—Ç–∏</span></button>
      <button class="nav-tab" data-tab="market" onclick="goTab('market')"><i class="fas fa-store"></i> <span data-ru="–†—ã–Ω–æ–∫" data-kg="–ë–∞–∑–∞—Ä">–†—ã–Ω–æ–∫</span></button>
      <button class="nav-tab" data-tab="jobs" onclick="goTab('jobs')"><i class="fas fa-briefcase"></i> <span data-ru="–í–∞–∫–∞–Ω—Å–∏–∏" data-kg="–í–∞–∫–∞–Ω—Å–∏—è–ª–∞—Ä">–í–∞–∫–∞–Ω—Å–∏–∏</span></button>
      <button class="nav-tab" data-tab="chat" onclick="goTab('chat')"><i class="fas fa-comments"></i> <span data-ru="–ß–∞—Ç" data-kg="–ß–∞—Ç">–ß–∞—Ç</span></button>
      <button class="nav-tab" data-tab="about" onclick="goTab('about')"><i class="fas fa-city"></i> <span data-ru="–û –≥–æ—Ä–æ–¥–µ" data-kg="–®–∞–∞—Ä –∂”©–Ω“Ø–Ω–¥”©">–û –≥–æ—Ä–æ–¥–µ</span></button>
      <button class="nav-tab" data-tab="contacts" onclick="goTab('contacts')"><i class="fas fa-address-book"></i> <span data-ru="–ö–æ–Ω—Ç–∞–∫—Ç—ã" data-kg="–ë–∞–π–ª–∞–Ω—ã—à—Ç–∞—Ä">–ö–æ–Ω—Ç–∞–∫—Ç—ã</span></button>
    </div>
  </nav>
</header>

<div class="container">

  <!-- –ù–û–í–û–°–¢–ò -->
  <div class="section on" id="sec-news">
    <div class="search-bar">
      <input type="text" id="newsSearch" placeholder="üîç –ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π..." oninput="filterPosts()">
    </div>
    <div class="loader" id="newsLoader"><div class="spinner"></div><p>–ó–∞–≥—Ä—É–∑–∫–∞...</p></div>
    <div class="news-grid" id="newsGrid"></div>
    <div class="empty" id="newsEmpty" style="display:none"><i class="fas fa-newspaper"></i><p>–ù–æ–≤–æ—Å—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p></div>
  </div>

  <!-- –†–´–ù–û–ö -->
  <div class="section" id="sec-market">
    <div class="market-cats" id="marketCats">
      <button class="cat-btn on" data-cat="all"><i class="fas fa-th"></i> <span data-ru="–í—Å–µ" data-kg="–ë–∞–∞—Ä—ã">–í—Å–µ</span></button>
      <button class="cat-btn" data-cat="tech"><i class="fas fa-laptop"></i> <span data-ru="–¢–µ—Ö–Ω–∏–∫–∞" data-kg="–¢–µ—Ö–Ω–∏–∫–∞">–¢–µ—Ö–Ω–∏–∫–∞</span></button>
      <button class="cat-btn" data-cat="land"><i class="fas fa-map-marked-alt"></i> <span data-ru="–£—á–∞—Å—Ç–∫–∏" data-kg="–£—á–∞—Å—Ç–æ–∫—Ç–æ—Ä">–£—á–∞—Å—Ç–∫–∏</span></button>
      <button class="cat-btn" data-cat="acc"><i class="fas fa-gem"></i> <span data-ru="–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã" data-kg="–ê–∫—Å–µ—Å—Å—É–∞—Ä–ª–∞—Ä">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</span></button>
      <button class="cat-btn" data-cat="cars"><i class="fas fa-car"></i> <span data-ru="–ú–∞—à–∏–Ω—ã" data-kg="–£–Ω–∞–∞–ª–∞—Ä">–ú–∞—à–∏–Ω—ã</span></button>
      <button class="cat-btn" data-cat="animals"><i class="fas fa-paw"></i> <span data-ru="–ñ–∏–≤–æ—Ç–Ω—ã–µ" data-kg="–ñ–∞–Ω—ã–±–∞—Ä–ª–∞—Ä">–ñ–∏–≤–æ—Ç–Ω—ã–µ</span></button>
      <button class="cat-btn" data-cat="materials"><i class="fas fa-hammer"></i> <span data-ru="–ú–∞—Ç–µ—Ä–∏–∞–ª—ã" data-kg="–ú–∞—Ç–µ—Ä–∏–∞–ª–¥–∞—Ä">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</span></button>
    </div>
    <div class="search-bar">
      <input type="text" id="marketSearch" placeholder="üîç –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." oninput="filterMarket()">
    </div>
    <div class="loader" id="marketLoader"><div class="spinner"></div><p>–ó–∞–≥—Ä—É–∑–∫–∞...</p></div>
    <div class="market-grid" id="marketGrid"></div>
    <div class="empty" id="marketEmpty" style="display:none"><i class="fas fa-store"></i><p data-ru="–û–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç" data-kg="–ñ–∞—Ä—ã—è–ª–æ–æ–ª–æ—Ä –∂–æ–∫">–û–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</p></div>
  </div>

  <!-- –í–ê–ö–ê–ù–°–ò–ò -->
  <div class="section" id="sec-jobs">
    <div class="search-bar">
      <input type="text" id="jobsSearch" placeholder="üîç –ü–æ–∏—Å–∫ –≤–∞–∫–∞–Ω—Å–∏–π..." oninput="filterJobs()">
    </div>
    <div class="loader" id="jobsLoader"><div class="spinner"></div><p>–ó–∞–≥—Ä—É–∑–∫–∞...</p></div>
    <div class="jobs-list" id="jobsList"></div>
    <div class="empty" id="jobsEmpty" style="display:none"><i class="fas fa-briefcase"></i><p data-ru="–í–∞–∫–∞–Ω—Å–∏–π –ø–æ–∫–∞ –Ω–µ—Ç" data-kg="–í–∞–∫–∞–Ω—Å–∏—è–ª–∞—Ä –∂–æ–∫">–í–∞–∫–∞–Ω—Å–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</p></div>
  </div>

  <!-- –ß–ê–¢ -->
  <div class="section" id="sec-chat">
    <div id="chatAuth" style="display:none" class="empty">
      <i class="fas fa-lock"></i>
      <p data-ru="–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —á–∞—Ç—É –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏" data-kg="–ß–∞—Ç–∫–∞ –∫–∏—Ä“Ø“Ø “Ø—á“Ø–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∫–µ—Ä–µ–∫">–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —á–∞—Ç—É –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏</p>
      <button class="btn-full" style="max-width:200px;margin:12px auto 0" onclick="openModal('loginModal')">–í–æ–π—Ç–∏</button>
    </div>
    <div class="chat-layout" id="chatLayout" style="display:none">
      <div class="chat-list" id="chatListPanel">
        <div class="chat-list-header">üí¨ –°–æ–æ–±—â–µ–Ω–∏—è</div>
        <div id="chatListItems"></div>
      </div>
      <div class="chat-window">
        <div class="chat-empty" id="chatEmpty"><i class="fas fa-comments"></i><p>–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</p></div>
        <div id="chatActive" style="display:none;height:100%;flex-direction:column">
          <div class="chat-win-header">
            <div class="chat-win-header-ava" id="chatWinAva"></div>
            <div>
              <div class="chat-win-header-name" id="chatWinName"></div>
            </div>
          </div>
          <div class="chat-messages" id="chatMessages"></div>
          <div class="chat-input-area">
            <button class="chat-attach" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ"><i class="fas fa-paperclip"></i><input type="file" accept="image/*" onchange="sendImg(event)"></button>
            <input class="chat-input" id="msgInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." onkeydown="if(event.key==='Enter')sendMsg()">
            <button class="chat-send" onclick="sendMsg()"><i class="fas fa-paper-plane"></i></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –û –ì–û–†–û–î–ï -->
  <div class="section" id="sec-about">
    <div class="about-card">
      <h2><i class="fas fa-city"></i> <span data-ru="–û –≥–æ—Ä–æ–¥–µ –ù–æ–æ–∫–∞—Ç" data-kg="–ù–æ–æ–∫–∞—Ç —à–∞–∞—Ä—ã –∂”©–Ω“Ø–Ω–¥”©">–û –≥–æ—Ä–æ–¥–µ –ù–æ–æ–∫–∞—Ç</span></h2>
      <p data-ru="–ù–æ–æ–∫–∞—Ç ‚Äî –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Ü–µ–Ω—Ç—Ä –ù–æ–æ–∫–∞—Ç—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞ –û—à—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞. –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω –≤ —é–≥–æ-–∑–∞–ø–∞–¥–Ω–æ–π —á–∞—Å—Ç–∏ —Å—Ç—Ä–∞–Ω—ã." data-kg="–ù–æ–æ–∫–∞—Ç ‚Äî –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–¥—ã–Ω –û—à –æ–±–ª–∞—Å—Ç—ã–Ω—ã–Ω –ù–æ–æ–∫–∞—Ç —Ä–∞–π–æ–Ω—É–Ω—É–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–¥–∏–∫ –±–æ—Ä–±–æ—Ä—É.">
        –ù–æ–æ–∫–∞—Ç ‚Äî –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Ü–µ–Ω—Ç—Ä –ù–æ–æ–∫–∞—Ç—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞ –û—à—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞. –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω –≤ —é–≥–æ-–∑–∞–ø–∞–¥–Ω–æ–π —á–∞—Å—Ç–∏ —Å—Ç—Ä–∞–Ω—ã.
      </p>
      <p data-ru="–ì–æ—Ä–æ–¥ –∏–∑–≤–µ—Å—Ç–µ–Ω —Å–≤–æ–µ–π –±–æ–≥–∞—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π, –∫—É–ª—å—Ç—É—Ä–Ω—ã–º –Ω–∞—Å–ª–µ–¥–∏–µ–º –∏ –≥–æ—Å—Ç–µ–ø—Ä–∏–∏–º–Ω—ã–º–∏ –∂–∏—Ç–µ–ª—è–º–∏. –ù–æ–æ–∫–∞—Ç –∏–≥—Ä–∞–µ—Ç –≤–∞–∂–Ω—É—é —Ä–æ–ª—å –≤ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π –∂–∏–∑–Ω–∏ —Ä–µ–≥–∏–æ–Ω–∞." data-kg="–®–∞–∞—Ä ”©–∑“Ø–Ω“Ø–Ω –±–∞–π —Ç–∞—Ä—ã—Ö—ã –∂–∞–Ω–∞ –º–µ–π–º–∞–Ω–¥–æ—Å –∂–∞—à–æ–æ—á—É–ª–∞—Ä—ã –º–µ–Ω–µ–Ω –±–µ–ª–≥–∏–ª“Ø“Ø.">
        –ì–æ—Ä–æ–¥ –∏–∑–≤–µ—Å—Ç–µ–Ω —Å–≤–æ–µ–π –±–æ–≥–∞—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π, –∫—É–ª—å—Ç—É—Ä–Ω—ã–º –Ω–∞—Å–ª–µ–¥–∏–µ–º –∏ –≥–æ—Å—Ç–µ–ø—Ä–∏–∏–º–Ω—ã–º–∏ –∂–∏—Ç–µ–ª—è–º–∏.
      </p>
    </div>
  </div>

  <!-- –ö–û–ù–¢–ê–ö–¢–´ -->
  <div class="section" id="sec-contacts">
    <div class="about-card">
      <h2><i class="fas fa-phone"></i> <span data-ru="–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏" data-kg="–ë–∏–∑ –º–µ–Ω–µ–Ω –±–∞–π–ª–∞–Ω—ã—à—ã“£—ã–∑">–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏</span></h2>
      <p data-ru="–ï—Å—Ç—å –Ω–æ–≤–æ—Å—Ç—å –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ? –ü–∏—à–∏—Ç–µ –Ω–∞–º!" data-kg="–ñ–∞“£—ã–ª—ã–∫ –∂–µ —Å—É–Ω—É—à –±–∞—Ä–±—ã?">–ï—Å—Ç—å –Ω–æ–≤–æ—Å—Ç—å –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ? –ü–∏—à–∏—Ç–µ –Ω–∞–º!</p>
    </div>
    <div class="contact-grid">
      <div class="contact-item">
        <div class="contact-item-icon"><i class="fab fa-telegram" style="color:#0088cc"></i></div>
        <h4>Telegram</h4>
        <a href="https://t.me/Nookat_day" target="_blank">@Nookat_day</a>
        <p data-ru="–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª" data-kg="–†–∞—Å–º–∏–π –∫–∞–Ω–∞–ª">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª</p>
      </div>
      <div class="contact-item">
        <div class="contact-item-icon"><i class="fab fa-instagram" style="color:#e1306c"></i></div>
        <h4>Instagram</h4>
        <a href="https://instagram.com/nookat.news" target="_blank">@nookat.news</a>
        <p data-ru="–°–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–∞–º–∏" data-kg="–ë–∏–∑–¥–∏–Ω Instagram">–°–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–∞–º–∏</p>
      </div>
      <div class="contact-item">
        <div class="contact-item-icon"><i class="fab fa-whatsapp" style="color:#25d366"></i></div>
        <h4>WhatsApp</h4>
        <a href="https://wa.me/+996701775688" target="_blank">+996 701 775 688</a>
        <p data-ru="–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º" data-kg="–ë–∏–∑–≥–µ –∂–∞–∑—ã“£—ã–∑">–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º</p>
      </div>
      <div class="contact-item">
        <div class="contact-item-icon"><i class="fas fa-envelope" style="color:var(--primary)"></i></div>
        <h4>Email</h4>
        <a href="mailto:nookat.nws@gmail.com">nookat.nws@gmail.com</a>
        <p data-ru="–î–µ–ª–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã" data-kg="–ò—à —Å—É—Ä–æ–æ–ª–æ—Ä—É">–î–µ–ª–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã</p>
      </div>
      <div class="contact-item">
        <div class="contact-item-icon"><i class="fas fa-phone" style="color:var(--success)"></i></div>
        <h4 data-ru="–¢–µ–ª–µ—Ñ–æ–Ω" data-kg="–¢–µ–ª–µ—Ñ–æ–Ω">–¢–µ–ª–µ—Ñ–æ–Ω</h4>
        <a href="tel:+996701775688">+996 701 775 688</a>
        <p data-ru="–ó–≤–æ–Ω–∏—Ç–µ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è" data-kg="–ö–∞–∞–ª–∞–≥–∞–Ω —É–±–∞–∫—Ç–∞ —á–∞–ª—ã“£—ã–∑">–ó–≤–æ–Ω–∏—Ç–µ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è</p>
      </div>
      <div class="contact-item">
        <div class="contact-item-icon"><i class="fas fa-map-marker-alt" style="color:var(--danger)"></i></div>
        <h4 data-ru="–ê–¥—Ä–µ—Å" data-kg="–î–∞—Ä–µ–∫">–ê–¥—Ä–µ—Å</h4>
        <p style="color:var(--text);font-weight:700" data-ru="–≥. –ù–æ–æ–∫–∞—Ç, –û—à—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å" data-kg="–ù–æ–æ–∫–∞—Ç, –û—à –æ–±–ª–∞—Å—Ç—ã">–≥. –ù–æ–æ–∫–∞—Ç, –û—à—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</p>
      </div>
    </div>
  </div>

  <!-- –ü–†–û–§–ò–õ–¨ -->
  <div class="section" id="sec-profile">
    <div class="profile-header" id="profileHeader">
      <img src="https://ui-avatars.com/api/?name=U&background=2563eb&color=fff" class="profile-ava" id="profileAva">
      <div class="profile-name" id="profileName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
      <div class="profile-email" id="profileEmail"></div>
    </div>
    <div class="profile-tabs">
      <button class="profile-tab on" onclick="switchProfileTab('myPosts', this)">–ú–æ–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</button>
      <button class="profile-tab" onclick="switchProfileTab('settings', this)">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      <button class="profile-tab" onclick="logout()" style="color:var(--danger)">–í—ã–π—Ç–∏</button>
    </div>
    <div id="profileMyPosts">
      <div class="loader" id="myPostsLoader" style="display:none"><div class="spinner"></div><p>–ó–∞–≥—Ä—É–∑–∫–∞...</p></div>
      <div class="my-posts-grid" id="myPostsGrid"></div>
      <div class="empty" id="myPostsEmpty" style="display:none"><i class="fas fa-folder-open"></i><p>–ù–µ—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–π</p></div>
    </div>
    <div id="profileSettings" style="display:none">
      <div class="about-card">
        <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h2>
        <div class="avatar-upload">
          <img src="https://ui-avatars.com/api/?name=U&background=2563eb&color=fff" class="avatar-preview-circle" id="settingsAvaPreview">
          <button class="avatar-upload-btn">–°–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ<input type="file" accept="image/*" onchange="changeProfilePhoto(event)"></button>
        </div>
        <div class="form-group"><label>–ò–º—è</label><input class="form-input" id="settingsName" placeholder="–í–∞—à–µ –∏–º—è"></div>
        <div class="form-group"><label>–§–∞–º–∏–ª–∏—è</label><input class="form-input" id="settingsSurname" placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è"></div>
        <div class="form-group"><label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label><input class="form-input" type="password" id="settingsPass" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –µ—Å–ª–∏ –Ω–µ –º–µ–Ω—è—Ç—å"></div>
        <button class="btn-full" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

</div>

<!-- FAB -->
<button class="fab" id="fabBtn" onclick="handleFab()" title="–î–æ–±–∞–≤–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é"><i class="fas fa-plus"></i></button>
<button class="scroll-up" id="scrollUp" onclick="window.scrollTo({top:0,behavior:'smooth'})"><i class="fas fa-arrow-up"></i></button>

<!-- –í–•–û–î -->
<div class="overlay" id="loginModal">
  <div class="modal">
    <div class="modal-header">
      <h2>üëã –í–æ–π—Ç–∏</h2>
      <button class="close-btn" onclick="closeModal('loginModal')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="social-auth">
        <button class="social-btn" onclick="googleLogin()"><i class="fab fa-google" style="color:#ea4335"></i> Google</button>
        <button class="social-btn" onclick="openModal('phoneModal');closeModal('loginModal')"><i class="fas fa-phone" style="color:var(--success)"></i> –ü–æ –Ω–æ–º–µ—Ä—É</button>
      </div>
      <div class="divider">–∏–ª–∏ —á–µ—Ä–µ–∑ email</div>
      <div class="form-group"><label>Email</label><input class="form-input" id="loginEmail" type="email" placeholder="your@email.com"></div>
      <div class="form-group"><label>–ü–∞—Ä–æ–ª—å</label><input class="form-input" id="loginPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
      <div class="error-msg" id="loginErr"></div>
      <button class="btn-full" onclick="emailLogin()">–í–æ–π—Ç–∏</button>
      <div class="switch-link">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a onclick="openModal('regModal');closeModal('loginModal')">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></div>
    </div>
  </div>
</div>

<!-- –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø -->
<div class="overlay" id="regModal">
  <div class="modal">
    <div class="modal-header">
      <h2>üöÄ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
      <button class="close-btn" onclick="closeModal('regModal')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="social-auth">
        <button class="social-btn" onclick="googleLogin()"><i class="fab fa-google" style="color:#ea4335"></i> Google</button>
        <button class="social-btn" onclick="openModal('phoneModal');closeModal('regModal')"><i class="fas fa-phone" style="color:var(--success)"></i> –ü–æ –Ω–æ–º–µ—Ä—É</button>
      </div>
      <div class="divider">–∏–ª–∏ —á–µ—Ä–µ–∑ email</div>
      <div class="avatar-upload">
        <img src="https://ui-avatars.com/api/?name=?&background=e2e8f0&color=64748b" class="avatar-preview-circle" id="regAvaPreview">
        <button class="avatar-upload-btn">üì∑ –§–æ—Ç–æ<input type="file" accept="image/*" onchange="previewRegAva(event)"></button>
        <span style="font-size:.8rem;color:var(--text2)">(–ø–æ –∂–µ–ª–∞–Ω–∏—é)</span>
      </div>
      <div class="form-row">
        <div class="form-group"><label>–ò–º—è *</label><input class="form-input" id="regName" placeholder="–ò–º—è"></div>
        <div class="form-group"><label>–§–∞–º–∏–ª–∏—è</label><input class="form-input" id="regSurname" placeholder="–§–∞–º–∏–ª–∏—è (–Ω–µ–æ–±—è–∑.)"></div>
      </div>
      <div class="form-group"><label>Email *</label><input class="form-input" id="regEmail" type="email" placeholder="your@email.com"></div>
      <div class="form-group">
        <label>–ü–∞—Ä–æ–ª—å *</label>
        <input class="form-input" id="regPass" type="password" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" oninput="checkStrength(this.value)">
        <div class="strength-bar"><div class="strength-fill" id="strengthFill"></div></div>
        <div style="font-size:.75rem;color:var(--text2);margin-top:4px" id="strengthText"></div>
      </div>
      <div class="form-group"><label>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è *</label><input class="form-input" id="regPass2" type="password" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å"></div>
      <div class="error-msg" id="regErr"></div>
      <button class="btn-full" onclick="emailRegister()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
      <div class="switch-link">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a onclick="openModal('loginModal');closeModal('regModal')">–í–æ–π—Ç–∏</a></div>
    </div>
  </div>
</div>

<!-- –í–•–û–î –ü–û –¢–ï–õ–ï–§–û–ù–£ -->
<div class="overlay" id="phoneModal">
  <div class="modal">
    <div class="modal-header">
      <h2>üì± –í—Ö–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É</h2>
      <button class="close-btn" onclick="closeModal('phoneModal')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
        <div class="phone-row">
          <select class="form-select country-code" id="countryCode">
            <option value="+996">üá∞üá¨ +996</option>
            <option value="+7">üá∑üá∫ +7</option>
            <option value="+998">üá∫üáø +998</option>
            <option value="+992">üáπüáØ +992</option>
            <option value="+380">üá∫üá¶ +380</option>
          </select>
          <input class="form-input" id="phoneNum" type="tel" placeholder="700 000 000">
        </div>
      </div>
      <div id="phoneCodeSection" style="display:none">
        <div class="form-group"><label>–ö–æ–¥ –∏–∑ SMS</label><input class="form-input" id="smsCode" placeholder="000000"></div>
        <button class="btn-full" onclick="verifyCode()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      </div>
      <button class="btn-full" id="sendCodeBtn" onclick="sendSmsCode()">–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥</button>
      <div id="recaptcha-container"></div>
      <div class="error-msg" id="phoneErr"></div>
    </div>
  </div>
</div>

<!-- –î–û–ë–ê–í–ò–¢–¨ –ù–û–í–û–°–¢–¨ (–ê–î–ú–ò–ù) -->
<div class="overlay" id="addNewsModal">
  <div class="modal modal-lg">
    <div class="modal-header">
      <h2>üì∞ –ù–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å</h2>
      <button class="close-btn" onclick="closeModal('addNewsModal')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-group"><label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ *</label><input class="form-input" id="newTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏"></div>
      <div class="form-group"><label>–¢–µ–∫—Å—Ç *</label><textarea class="form-textarea" id="newText" rows="5" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ..."></textarea></div>
      <div class="form-group">
        <label>–§–æ—Ç–æ</label>
        <div class="file-drop">
          <input type="file" accept="image/*" id="newImg" onchange="previewFile(event,'newImgPreview')">
          <div class="file-drop-icon"><i class="fas fa-cloud-upload-alt"></i></div>
          <p>–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ</p>
        </div>
        <img class="img-preview" id="newImgPreview">
      </div>
      <div class="upload-progress" id="newsUploadProgress">
        <div class="upload-progress-text">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ...</div>
        <div class="upload-progress-bar"><div class="upload-progress-fill" id="newsUploadFill"></div></div>
      </div>
      <button class="btn-full" id="publishNewsBtn" onclick="publishNews()">‚ú® –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
    </div>
  </div>
</div>

<!-- –î–û–ë–ê–í–ò–¢–¨ –û–ë–™–Ø–í–õ–ï–ù–ò–ï -->
<div class="overlay" id="addMarketModal">
  <div class="modal modal-lg">
    <div class="modal-header">
      <h2>üõçÔ∏è –ù–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h2>
      <button class="close-btn" onclick="closeModal('addMarketModal')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ *</label>
        <div class="file-drop">
          <input type="file" accept="image/*" id="mktImg" onchange="previewFile(event,'mktImgPreview')">
          <div class="file-drop-icon"><i class="fas fa-camera"></i></div>
          <p>–î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞</p>
        </div>
        <img class="img-preview" id="mktImgPreview">
      </div>
      <div class="form-row">
        <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label><input class="form-input" id="mktTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"></div>
        <div class="form-group"><label>–¶–µ–Ω–∞ *</label><input class="form-input" id="mktPrice" type="number" placeholder="0 —Å–æ–º"></div>
      </div>
      <div class="form-group">
        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
        <select class="form-select" id="mktCat">
          <option value="tech">–¢–µ—Ö–Ω–∏–∫–∞</option>
          <option value="land">–£—á–∞—Å—Ç–∫–∏</option>
          <option value="acc">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</option>
          <option value="cars">–ú–∞—à–∏–Ω—ã</option>
          <option value="animals">–ñ–∏–≤–æ—Ç–Ω—ã–µ</option>
          <option value="materials">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</option>
        </select>
      </div>
      <div class="form-group"><label>–û–ø–∏—Å–∞–Ω–∏–µ</label><textarea class="form-textarea" id="mktDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ..."></textarea></div>
      <div class="form-group"><label>üìç –ú–µ—Å—Ç–æ</label><input class="form-input" id="mktLoc" placeholder="–ù–æ–æ–∫–∞—Ç, ..."></div>
      <div style="background:var(--bg);border-radius:12px;padding:14px;margin-bottom:14px">
        <p style="font-weight:800;margin-bottom:10px;font-size:.9rem">üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</p>
        <div class="form-group" style="margin-bottom:8px">
          <div class="phone-row">
            <select class="form-select country-code" id="mktWaCode"><option value="+996">üá∞üá¨ +996</option><option value="+7">üá∑üá∫ +7</option></select>
            <input class="form-input" id="mktWa" placeholder="WhatsApp –Ω–æ–º–µ—Ä *">
          </div>
        </div>
        <div class="form-group" style="margin-bottom:8px">
          <div class="phone-row">
            <select class="form-select country-code" id="mktPhCode"><option value="+996">üá∞üá¨ +996</option><option value="+7">üá∑üá∫ +7</option></select>
            <input class="form-input" id="mktPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–Ω–µ–æ–±—è–∑.)">
          </div>
        </div>
        <div class="form-group" style="margin-bottom:0"><input class="form-input" id="mktTg" placeholder="Telegram: @username (–Ω–µ–æ–±—è–∑.)"></div>
      </div>
      <div class="upload-progress" id="mktUploadProgress">
        <div class="upload-progress-text">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ...</div>
        <div class="upload-progress-bar"><div class="upload-progress-fill" id="mktUploadFill"></div></div>
      </div>
      <button class="btn-full" id="publishMarketBtn" onclick="publishMarket()">üì§ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
    </div>
  </div>
</div>

<!-- –î–û–ë–ê–í–ò–¢–¨ –í–ê–ö–ê–ù–°–ò–Æ -->
<div class="overlay" id="addJobModal">
  <div class="modal modal-lg">
    <div class="modal-header">
      <h2>üíº –ù–æ–≤–∞—è –≤–∞–∫–∞–Ω—Å–∏—è</h2>
      <button class="close-btn" onclick="closeModal('addJobModal')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group"><label>–î–æ–ª–∂–Ω–æ—Å—Ç—å *</label><input class="form-input" id="jobTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏"></div>
        <div class="form-group"><label>–ó–∞—Ä–ø–ª–∞—Ç–∞</label><input class="form-input" id="jobSalary" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 15 000 —Å–æ–º"></div>
      </div>
      <div class="form-group"><label>–ö–æ–º–ø–∞–Ω–∏—è / –†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å *</label><input class="form-input" id="jobCompany" placeholder="–ò–º—è –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏"></div>
      <div class="form-group"><label>–û–ø–∏—Å–∞–Ω–∏–µ *</label><textarea class="form-textarea" id="jobDesc" placeholder="–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è, —É—Å–ª–æ–≤–∏—è..."></textarea></div>
      <div class="form-group"><label>üìç –ú–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã</label><input class="form-input" id="jobLoc" placeholder="–ù–æ–æ–∫–∞—Ç, ..."></div>
      <div style="background:var(--bg);border-radius:12px;padding:14px;margin-bottom:14px">
        <p style="font-weight:800;margin-bottom:10px;font-size:.9rem">üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏</p>
        <div class="phone-row" style="margin-bottom:8px">
          <select class="form-select country-code" id="jobPhCode"><option value="+996">üá∞üá¨ +996</option><option value="+7">üá∑üá∫ +7</option></select>
          <input class="form-input" id="jobPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω *">
        </div>
        <input class="form-input" id="jobTg" placeholder="Telegram (–Ω–µ–æ–±—è–∑.)">
      </div>
      <button class="btn-full" id="publishJobBtn" onclick="publishJob()">üì§ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
    </div>
  </div>
</div>

<!-- –ü–†–û–°–ú–û–¢–† –ü–û–°–¢–ê -->
<div class="overlay" id="postModal">
  <div class="modal modal-lg">
    <div class="modal-header">
      <h2 id="postModalTitle"></h2>
      <button class="close-btn" onclick="closeModal('postModal')">‚úï</button>
    </div>
    <div class="modal-body">
      <img id="postModalImg" style="width:100%;border-radius:12px;margin-bottom:14px;display:none" alt="">
      <div style="font-size:.8rem;color:var(--text2);margin-bottom:12px" id="postModalDate"></div>
      <div id="postModalBody" style="line-height:1.8;font-size:.95rem;margin-bottom:16px"></div>
      <div id="postModalContacts"></div>
      <button class="open-chat-btn" id="postChatBtn" style="display:none" onclick="startChatFromPost()">
        <i class="fas fa-comments"></i> –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º
      </button>
    </div>
  </div>
</div>

<!-- –¢–û–°–¢ -->
<div class="toast" id="toast"><span id="toastIcon"></span><span id="toastText"></span></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword,
  signInWithPopup, GoogleAuthProvider, RecaptchaVerifier, signInWithPhoneNumber,
  onAuthStateChanged, signOut, updateProfile, updatePassword
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore, collection, addDoc, query, orderBy, onSnapshot,
  deleteDoc, doc, updateDoc, increment, where, getDocs,
  serverTimestamp, setDoc, getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ===== FIREBASE INIT =====
const cfg = {
  apiKey:"AIzaSyAHNE24jDk8wysKkctBBFNSrSgmQr3PPaM",
  authDomain:"mydistrictnews-fa379.firebaseapp.com",
  projectId:"mydistrictnews-fa379",
  storageBucket:"mydistrictnews-fa379.firebasestorage.app",
  messagingSenderId:"62802053109",
  appId:"1:62802053109:web:f4024816d979a79890c2bc"
};
const app = initializeApp(cfg);
const auth = getAuth(app);
const db = getFirestore(app);

// ===== ADMIN UID ‚Äî –≤—Å—Ç–∞–≤—å —Å–≤–æ–π UID –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ =====
const ADMIN_UID = "–í–°–¢–ê–í–¨–¢–ï_–í–ê–®_UID_–ó–î–ï–°–¨";

// ===== CLOUDINARY =====
const CLOUD_NAME = 'dsd7kqaon';
const UPLOAD_PRESET = 'herrozzv';

async function uploadToCloudinary(file, onProgress) {
  return new Promise((resolve, reject) => {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('upload_preset', UPLOAD_PRESET);

    const xhr = new XMLHttpRequest();
    xhr.open('POST', `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`);

    if (onProgress) {
      xhr.upload.onprogress = (e) => {
        if (e.lengthComputable) onProgress(Math.round(e.loaded / e.total * 100));
      };
    }

    xhr.onload = () => {
      const data = JSON.parse(xhr.responseText);
      if (data.secure_url) resolve(data.secure_url);
      else reject(new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ: ' + (data.error?.message || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞')));
    };
    xhr.onerror = () => reject(new Error('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ'));
    xhr.send(formData);
  });
}

// ===== –°–û–°–¢–û–Ø–ù–ò–ï =====
let currentUser = null;
let allNews = [], allMarket = [], allJobs = [];
let currentMarketCat = 'all';
let activeChatUserId = null;
let confirmResult = null;
let currentPostData = null;
let avatarFile = null;
let avaClickCount = 0, avaClickTimer = null;
let chatMsgUnsub = null; // –¥–ª—è –æ—Ç–ø–∏—Å–∫–∏ –æ—Ç —Å—Ç–∞—Ä—ã—Ö —á–∞—Ç–æ–≤

// ===== –ê–í–ê –ö–õ–ò–ö =====
window.handleAvaClick = () => {
  avaClickCount++;
  clearTimeout(avaClickTimer);
  avaClickTimer = setTimeout(() => { avaClickCount = 0; }, 800);
  if (avaClickCount >= 3) { goTab('profile'); avaClickCount = 0; return; }
  goTab('profile');
};

// ===== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø =====
onAuthStateChanged(auth, async user => {
  currentUser = user;
  if (user) {
    document.getElementById('guestBtns').style.display = 'none';
    const avaBtn = document.getElementById('userAvaBtn');
    avaBtn.style.display = 'block';
    avaBtn.src = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || 'U')}&background=2563eb&color=fff`;
    updateProfileUI();
    if (document.getElementById('sec-chat').classList.contains('on')) showChat();
  } else {
    document.getElementById('guestBtns').style.display = 'flex';
    document.getElementById('userAvaBtn').style.display = 'none';
  }
});

function updateProfileUI() {
  if (!currentUser) return;
  const name = currentUser.displayName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
  document.getElementById('profileName').textContent = name;
  document.getElementById('profileEmail').textContent = currentUser.email || currentUser.phoneNumber || '';
  const ava = currentUser.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=2563eb&color=fff`;
  document.getElementById('profileAva').src = ava;
  document.getElementById('settingsAvaPreview').src = ava;
  document.getElementById('settingsName').value = name.split(' ')[0] || '';
  document.getElementById('settingsSurname').value = name.split(' ')[1] || '';
}

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ email
window.emailRegister = async () => {
  const name = document.getElementById('regName').value.trim();
  const surname = document.getElementById('regSurname').value.trim();
  const email = document.getElementById('regEmail').value.trim();
  const pass = document.getElementById('regPass').value;
  const pass2 = document.getElementById('regPass2').value;
  const err = document.getElementById('regErr');
  err.style.display = 'none';

  if (!name) { showErr(err, '–í–≤–µ–¥–∏—Ç–µ –∏–º—è'); return; }
  if (!email) { showErr(err, '–í–≤–µ–¥–∏—Ç–µ email'); return; }
  if (pass.length < 6) { showErr(err, '–ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤'); return; }
  if (pass !== pass2) { showErr(err, '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'); return; }

  try {
    const cred = await createUserWithEmailAndPassword(auth, email, pass);
    let photoURL = null;

    if (avatarFile) {
      showToast('warn', '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞...');
      photoURL = await uploadToCloudinary(avatarFile);
    }

    await updateProfile(cred.user, {
      displayName: name + (surname ? ' ' + surname : ''),
      photoURL
    });
    await setDoc(doc(db, 'users', cred.user.uid), {
      name, surname, email, photoURL: photoURL || null, createdAt: serverTimestamp()
    });

    avatarFile = null;
    closeModal('regModal');
    showToast('ok', '‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + name + '!');
  } catch (e) { showErr(err, firebaseError(e.code)); }
};

// –í—Ö–æ–¥ –ø–æ email
window.emailLogin = async () => {
  const email = document.getElementById('loginEmail').value.trim();
  const pass = document.getElementById('loginPass').value;
  const err = document.getElementById('loginErr');
  err.style.display = 'none';
  try {
    await signInWithEmailAndPassword(auth, email, pass);
    closeModal('loginModal');
    showToast('ok', '‚úÖ –í—ã –≤–æ—à–ª–∏!');
  } catch (e) { showErr(err, firebaseError(e.code)); }
};

// Google
window.googleLogin = async () => {
  try {
    const provider = new GoogleAuthProvider();
    const result = await signInWithPopup(auth, provider);
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firestore –µ—Å–ª–∏ –Ω–æ–≤—ã–π
    const userRef = doc(db, 'users', result.user.uid);
    const snap = await getDoc(userRef);
    if (!snap.exists()) {
      await setDoc(userRef, {
        name: result.user.displayName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
        email: result.user.email,
        photoURL: result.user.photoURL || null,
        createdAt: serverTimestamp()
      });
    }
    closeModal('loginModal'); closeModal('regModal');
    showToast('ok', '‚úÖ –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google –≤—ã–ø–æ–ª–Ω–µ–Ω!');
  } catch (e) { showToast('err', '–û—à–∏–±–∫–∞: ' + e.message); }
};

// –¢–µ–ª–µ—Ñ–æ–Ω
window.sendSmsCode = async () => {
  const code = document.getElementById('countryCode').value;
  const num = document.getElementById('phoneNum').value.trim();
  const err = document.getElementById('phoneErr');
  if (!num) { showErr(err, '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä'); return; }
  try {
    window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', { size: 'invisible' });
    confirmResult = await signInWithPhoneNumber(auth, code + num, window.recaptchaVerifier);
    document.getElementById('phoneCodeSection').style.display = 'block';
    document.getElementById('sendCodeBtn').style.display = 'none';
    showToast('ok', 'üì± SMS –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
  } catch (e) { showErr(err, e.message); }
};

window.verifyCode = async () => {
  const code = document.getElementById('smsCode').value.trim();
  try {
    await confirmResult.confirm(code);
    closeModal('phoneModal');
    showToast('ok', '‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!');
  } catch (e) { showToast('err', '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥'); }
};

// –í—ã—Ö–æ–¥
window.logout = async () => {
  await signOut(auth);
  goTab('news');
  showToast('ok', 'üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞');
};

// ===== CLOUDINARY –ê–í–ê–¢–ê–† =====
window.changeProfilePhoto = async (e) => {
  const file = e.target.files[0];
  if (!file || !currentUser) return;
  showToast('warn', '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ...');
  try {
    const url = await uploadToCloudinary(file);
    await updateProfile(currentUser, { photoURL: url });
    document.getElementById('settingsAvaPreview').src = url;
    document.getElementById('profileAva').src = url;
    document.getElementById('userAvaBtn').src = url;
    await updateDoc(doc(db, 'users', currentUser.uid), { photoURL: url });
    showToast('ok', '‚úÖ –§–æ—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ');
  } catch (e) { showToast('err', '–û—à–∏–±–∫–∞: ' + e.message); }
};

// ===== –ü–£–ë–õ–ò–ö–ê–¶–ò–ò =====

// –ù–æ–≤–æ—Å—Ç–∏ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)
window.publishNews = async () => {
  if (!currentUser || currentUser.uid !== ADMIN_UID) {
    showToast('err', '‚ùå –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞'); return;
  }
  const title = document.getElementById('newTitle').value.trim();
  const text = document.getElementById('newText').value.trim();
  const file = document.getElementById('newImg').files[0];
  if (!title || !text) { showToast('warn', '‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç'); return; }

  const btn = document.getElementById('publishNewsBtn');
  btn.disabled = true; btn.textContent = '‚è≥ –ü—É–±–ª–∏–∫–∞—Ü–∏—è...';

  try {
    let img = '';
    if (file) {
      document.getElementById('newsUploadProgress').style.display = 'block';
      img = await uploadToCloudinary(file, (p) => {
        document.getElementById('newsUploadFill').style.width = p + '%';
      });
      document.getElementById('newsUploadProgress').style.display = 'none';
    }
    await addDoc(collection(db, 'posts'), {
      title, text, img, date: serverTimestamp(),
      views: 0, likes: 0, hearts: 0, fire: 0, authorId: currentUser.uid
    });
    closeModal('addNewsModal');
    document.getElementById('newTitle').value = '';
    document.getElementById('newText').value = '';
    document.getElementById('newImg').value = '';
    document.getElementById('newImgPreview').style.display = 'none';
    showToast('ok', '‚úÖ –ù–æ–≤–æ—Å—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞!');
  } catch (e) { showToast('err', '–û—à–∏–±–∫–∞: ' + e.message); }
  btn.disabled = false; btn.textContent = '‚ú® –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å';
};

// –†—ã–Ω–æ–∫
window.publishMarket = async () => {
  if (!currentUser) { openModal('loginModal'); return; }
  const title = document.getElementById('mktTitle').value.trim();
  const price = document.getElementById('mktPrice').value;
  const cat = document.getElementById('mktCat').value;
  const desc = document.getElementById('mktDesc').value.trim();
  const loc = document.getElementById('mktLoc').value.trim();
  const wa = document.getElementById('mktWaCode').value + document.getElementById('mktWa').value.trim();
  const phone = document.getElementById('mktPhCode').value + document.getElementById('mktPhone').value.trim();
  const tg = document.getElementById('mktTg').value.trim();
  const file = document.getElementById('mktImg').files[0];

  if (!title || !price || !file || !document.getElementById('mktWa').value.trim()) {
    showToast('warn', '‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ'); return;
  }

  const btn = document.getElementById('publishMarketBtn');
  btn.disabled = true; btn.textContent = '‚è≥ –ü—É–±–ª–∏–∫–∞—Ü–∏—è...';

  try {
    document.getElementById('mktUploadProgress').style.display = 'block';
    const img = await uploadToCloudinary(file, (p) => {
      document.getElementById('mktUploadFill').style.width = p + '%';
    });
    document.getElementById('mktUploadProgress').style.display = 'none';

    await addDoc(collection(db, 'market'), {
      title, price: Number(price), cat, desc, loc, img, wa, phone, tg,
      date: serverTimestamp(), views: 0, likes: 0,
      authorId: currentUser.uid,
      authorName: currentUser.displayName || '–ê–Ω–æ–Ω–∏–º',
      authorPhoto: currentUser.photoURL || null
    });
    closeModal('addMarketModal');
    // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
    ['mktTitle','mktPrice','mktDesc','mktLoc','mktWa','mktPhone','mktTg'].forEach(id => {
      document.getElementById(id).value = '';
    });
    document.getElementById('mktImg').value = '';
    document.getElementById('mktImgPreview').style.display = 'none';
    showToast('ok', '‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!');
  } catch (e) { showToast('err', '–û—à–∏–±–∫–∞: ' + e.message); }
  btn.disabled = false; btn.textContent = 'üì§ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å';
};

// –í–∞–∫–∞–Ω—Å–∏–∏
window.publishJob = async () => {
  if (!currentUser) { openModal('loginModal'); return; }
  const title = document.getElementById('jobTitle').value.trim();
  const salary = document.getElementById('jobSalary').value.trim();
  const company = document.getElementById('jobCompany').value.trim();
  const desc = document.getElementById('jobDesc').value.trim();
  const loc = document.getElementById('jobLoc').value.trim();
  const phone = document.getElementById('jobPhCode').value + document.getElementById('jobPhone').value.trim();
  const tg = document.getElementById('jobTg').value.trim();

  if (!title || !company || !desc || !document.getElementById('jobPhone').value.trim()) {
    showToast('warn', '‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è'); return;
  }

  const btn = document.getElementById('publishJobBtn');
  btn.disabled = true; btn.textContent = '‚è≥ –ü—É–±–ª–∏–∫–∞—Ü–∏—è...';

  try {
    await addDoc(collection(db, 'jobs'), {
      title, salary, company, desc, loc, phone, tg,
      date: serverTimestamp(), views: 0,
      authorId: currentUser.uid,
      authorName: currentUser.displayName || '–ê–Ω–æ–Ω–∏–º'
    });
    closeModal('addJobModal');
    ['jobTitle','jobSalary','jobCompany','jobDesc','jobLoc','jobPhone','jobTg'].forEach(id => {
      document.getElementById(id).value = '';
    });
    showToast('ok', '‚úÖ –í–∞–∫–∞–Ω—Å–∏—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞!');
  } catch (e) { showToast('err', '–û—à–∏–±–∫–∞: ' + e.message); }
  btn.disabled = false; btn.textContent = 'üì§ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å';
};

// ===== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• =====

const qNews = query(collection(db, 'posts'), orderBy('date', 'desc'));
onSnapshot(qNews, snap => {
  allNews = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  filterPosts();
  document.getElementById('newsLoader').style.display = 'none';
});

const qMarket = query(collection(db, 'market'), orderBy('date', 'desc'));
onSnapshot(qMarket, snap => {
  allMarket = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  filterMarket();
  document.getElementById('marketLoader').style.display = 'none';
});

const qJobs = query(collection(db, 'jobs'), orderBy('date', 'desc'));
onSnapshot(qJobs, snap => {
  allJobs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  filterJobs();
  document.getElementById('jobsLoader').style.display = 'none';
});

// ===== –†–ï–ù–î–ï–† –ù–û–í–û–°–¢–ï–ô =====
window.filterPosts = () => {
  const q = document.getElementById('newsSearch').value.toLowerCase();
  const filtered = allNews.filter(p =>
    p.title?.toLowerCase().includes(q) || p.text?.toLowerCase().includes(q)
  );
  renderNews(filtered);
};

// –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (–±–µ–∑ XSS)
const postStore = new Map();

function renderNews(posts) {
  const grid = document.getElementById('newsGrid');
  const empty = document.getElementById('newsEmpty');
  if (!posts.length) { grid.innerHTML = ''; empty.style.display = 'block'; return; }
  empty.style.display = 'none';

  posts.forEach(p => postStore.set('news_' + p.id, p));

  grid.innerHTML = posts.map(p => {
    const dateStr = p.date?.toDate ? fmtDate(p.date.toDate()) : '';
    const isNew = p.date?.toDate && (Date.now() - p.date.toDate().getTime()) < 86400000;
    return `
    <div class="news-card">
      <button class="three-dots" onclick="toggleDropdown('dd-${p.id}',event)"><i class="fas fa-ellipsis-v"></i></button>
      <div class="dropdown" id="dd-${p.id}">
        <div class="dropdown-item" onclick="sharePost('${p.id}')"><i class="fas fa-share-alt"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</div>
        <div class="dropdown-item red" onclick="reportPost('${p.id}')"><i class="fas fa-flag"></i> –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</div>
        ${currentUser?.uid === ADMIN_UID ? `<div class="dropdown-item red" onclick="deletePost('posts','${p.id}')"><i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å</div>` : ''}
      </div>
      ${p.img ? `<img class="news-card-img" src="${p.img}" alt="" loading="lazy">` : ''}
      <div class="news-card-body">
        <div class="news-card-meta">
          <span class="news-card-date">${dateStr}</span>
          ${isNew ? '<span class="news-card-badge">–ù–æ–≤–æ–µ</span>' : ''}
        </div>
        <h3 onclick="openNewsPost('${p.id}')">${escHtml(p.title)}</h3>
        <p class="news-card-text">${escHtml((p.text || '').substring(0, 110))}${(p.text || '').length > 110 ? '...' : ''}</p>
        <div class="news-card-footer">
          <div class="reactions">
            <button class="reaction-btn" onclick="react('posts','${p.id}','likes',this)">üëç ${p.likes || 0}</button>
            <button class="reaction-btn" onclick="react('posts','${p.id}','hearts',this)">‚ù§Ô∏è ${p.hearts || 0}</button>
            <button class="reaction-btn" onclick="react('posts','${p.id}','fire',this)">üî• ${p.fire || 0}</button>
          </div>
          <div class="post-stats"><i class="fas fa-eye"></i> ${p.views || 0}</div>
        </div>
      </div>
    </div>`;
  }).join('');
}

// ===== –†–ï–ù–î–ï–† –†–´–ù–ö–ê =====
window.filterMarket = () => {
  const q = document.getElementById('marketSearch').value.toLowerCase();
  let filtered = allMarket.filter(p =>
    p.title?.toLowerCase().includes(q) || p.desc?.toLowerCase().includes(q)
  );
  if (currentMarketCat !== 'all') filtered = filtered.filter(p => p.cat === currentMarketCat);
  renderMarket(filtered);
};

function renderMarket(items) {
  const grid = document.getElementById('marketGrid');
  const empty = document.getElementById('marketEmpty');
  if (!items.length) { grid.innerHTML = ''; empty.style.display = 'block'; return; }
  empty.style.display = 'none';

  items.forEach(p => postStore.set('market_' + p.id, p));

  grid.innerHTML = items.map(p => `
    <div class="market-card" onclick="openMarketPost('${p.id}')">
      <button class="three-dots" onclick="toggleDropdown('mdd-${p.id}',event);event.stopPropagation()"><i class="fas fa-ellipsis-v"></i></button>
      <div class="dropdown" id="mdd-${p.id}">
        <div class="dropdown-item" onclick="sharePost('${p.id}');event.stopPropagation()"><i class="fas fa-share-alt"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</div>
        <div class="dropdown-item red" onclick="reportPost('${p.id}');event.stopPropagation()"><i class="fas fa-flag"></i> –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</div>
        ${currentUser?.uid === p.authorId ? `<div class="dropdown-item red" onclick="deletePost('market','${p.id}');event.stopPropagation()"><i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å</div>` : ''}
      </div>
      <img class="market-card-img" src="${p.img}" alt="" loading="lazy">
      <div class="market-card-body">
        <div class="market-card-price">${fmtPrice(p.price)}</div>
        <div class="market-card-title">${escHtml(p.title)}</div>
        <div class="market-card-loc"><i class="fas fa-map-marker-alt"></i> ${escHtml(p.loc || '–ù–æ–æ–∫–∞—Ç')}</div>
        <div class="market-card-foot">
          <div class="market-card-seller">
            <img class="seller-ava" src="${p.authorPhoto || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(p.authorName || '?') + '&background=e2e8f0&color=64748b'}" alt="">
            ${escHtml(p.authorName || '–ê–Ω–æ–Ω–∏–º')}
          </div>
          <div class="post-stats"><i class="fas fa-eye"></i> ${p.views || 0}</div>
        </div>
      </div>
    </div>`).join('');
}

// ===== –†–ï–ù–î–ï–† –í–ê–ö–ê–ù–°–ò–ô =====
window.filterJobs = () => {
  const q = document.getElementById('jobsSearch').value.toLowerCase();
  const filtered = allJobs.filter(p =>
    p.title?.toLowerCase().includes(q) ||
    p.company?.toLowerCase().includes(q) ||
    p.desc?.toLowerCase().includes(q)
  );
  renderJobs(filtered);
};

function renderJobs(jobs) {
  const list = document.getElementById('jobsList');
  const empty = document.getElementById('jobsEmpty');
  if (!jobs.length) { list.innerHTML = ''; empty.style.display = 'block'; return; }
  empty.style.display = 'none';

  jobs.forEach(p => postStore.set('jobs_' + p.id, p));

  list.innerHTML = jobs.map(p => `
    <div class="job-card" onclick="openJobPost('${p.id}')">
      <button class="three-dots" onclick="toggleDropdown('jdd-${p.id}',event);event.stopPropagation()"><i class="fas fa-ellipsis-v"></i></button>
      <div class="dropdown" id="jdd-${p.id}">
        <div class="dropdown-item" onclick="sharePost('${p.id}');event.stopPropagation()"><i class="fas fa-share-alt"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</div>
        <div class="dropdown-item red" onclick="reportPost('${p.id}');event.stopPropagation()"><i class="fas fa-flag"></i> –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</div>
        ${currentUser?.uid === p.authorId ? `<div class="dropdown-item red" onclick="deletePost('jobs','${p.id}');event.stopPropagation()"><i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å</div>` : ''}
      </div>
      <div class="job-header">
        <div class="job-title">${escHtml(p.title)}</div>
        ${p.salary ? `<div class="job-salary">${escHtml(p.salary)}</div>` : ''}
      </div>
      <div class="job-company"><i class="fas fa-building"></i> ${escHtml(p.company)}</div>
      <div class="job-tags">
        ${p.loc ? `<span class="job-tag"><i class="fas fa-map-marker-alt"></i> ${escHtml(p.loc)}</span>` : ''}
      </div>
      <div class="job-foot">
        <span class="job-date">${p.date?.toDate ? fmtDate(p.date.toDate()) : ''}</span>
        <div class="post-stats"><i class="fas fa-eye"></i> ${p.views || 0}</div>
      </div>
    </div>`).join('');
}

// ===== –ü–†–û–°–ú–û–¢–† –ü–û–°–¢–û–í =====
window.openNewsPost = async (id) => {
  const p = postStore.get('news_' + id);
  if (!p) return;
  currentPostData = p;
  document.getElementById('postModalTitle').textContent = p.title;
  document.getElementById('postModalBody').textContent = p.text;
  document.getElementById('postModalDate').textContent = 'üìÖ ' + (p.date?.toDate ? fmtDate(p.date.toDate()) : '');
  const img = document.getElementById('postModalImg');
  if (p.img) { img.src = p.img; img.style.display = 'block'; } else { img.style.display = 'none'; }
  document.getElementById('postModalContacts').innerHTML = '';
  document.getElementById('postChatBtn').style.display = 'none';
  openModal('postModal');
  try { await updateDoc(doc(db, 'posts', p.id), { views: increment(1) }); } catch (e) {}
};

window.openMarketPost = async (id) => {
  const p = postStore.get('market_' + id);
  if (!p) return;
  currentPostData = p;
  document.getElementById('postModalTitle').textContent = p.title;
  document.getElementById('postModalBody').innerHTML = `
    <div style="font-size:1.3rem;font-weight:900;color:var(--primary);margin-bottom:8px">${fmtPrice(p.price)}</div>
    <p>${escHtml(p.desc || '')}</p>
    ${p.loc ? `<p style="margin-top:8px;color:var(--text2)"><i class="fas fa-map-marker-alt"></i> ${escHtml(p.loc)}</p>` : ''}`;
  document.getElementById('postModalDate').textContent = p.date?.toDate ? fmtDate(p.date.toDate()) : '';
  const img = document.getElementById('postModalImg');
  if (p.img) { img.src = p.img; img.style.display = 'block'; } else { img.style.display = 'none'; }
  let contacts = '';
  if (p.wa) contacts += `<div class="post-contact-row"><i class="fab fa-whatsapp" style="color:#25d366"></i><a href="https://wa.me/${p.wa.replace(/\D/g, '')}" target="_blank">${escHtml(p.wa)}</a></div>`;
  if (p.phone) contacts += `<div class="post-contact-row"><i class="fas fa-phone" style="color:var(--success)"></i><a href="tel:${p.phone}">${escHtml(p.phone)}</a></div>`;
  if (p.tg) contacts += `<div class="post-contact-row"><i class="fab fa-telegram" style="color:#0088cc"></i><span>${escHtml(p.tg)}</span></div>`;
  document.getElementById('postModalContacts').innerHTML = contacts;
  document.getElementById('postChatBtn').style.display =
    (p.authorId && currentUser && p.authorId !== currentUser.uid) ? 'flex' : 'none';
  openModal('postModal');
  try { await updateDoc(doc(db, 'market', p.id), { views: increment(1) }); } catch (e) {}
};

window.openJobPost = async (id) => {
  const p = postStore.get('jobs_' + id);
  if (!p) return;
  currentPostData = p;
  document.getElementById('postModalTitle').textContent = p.title;
  document.getElementById('postModalBody').innerHTML = `
    <p style="font-weight:700;margin-bottom:8px"><i class="fas fa-building"></i> ${escHtml(p.company)}</p>
    ${p.salary ? `<p style="color:var(--success);font-weight:900;font-size:1.1rem;margin-bottom:10px">${escHtml(p.salary)}</p>` : ''}
    <p>${escHtml(p.desc)}</p>
    ${p.loc ? `<p style="margin-top:8px;color:var(--text2)"><i class="fas fa-map-marker-alt"></i> ${escHtml(p.loc)}</p>` : ''}`;
  document.getElementById('postModalDate').textContent = p.date?.toDate ? fmtDate(p.date.toDate()) : '';
  document.getElementById('postModalImg').style.display = 'none';
  let contacts = '';
  if (p.phone) contacts += `<div class="post-contact-row"><i class="fas fa-phone" style="color:var(--success)"></i><a href="tel:${p.phone}">${escHtml(p.phone)}</a></div>`;
  if (p.tg) contacts += `<div class="post-contact-row"><i class="fab fa-telegram" style="color:#0088cc"></i><span>${escHtml(p.tg)}</span></div>`;
  document.getElementById('postModalContacts').innerHTML = contacts;
  document.getElementById('postChatBtn').style.display =
    (p.authorId && currentUser && p.authorId !== currentUser.uid) ? 'flex' : 'none';
  openModal('postModal');
  try { await updateDoc(doc(db, 'jobs', p.id), { views: increment(1) }); } catch (e) {}
};

// ===== –†–ï–ê–ö–¶–ò–ò =====
window.react = async (coll, id, field, btn) => {
  if (!currentUser) { showToast('warn', '‚ö†Ô∏è –í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã —Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏–∏'); return; }
  btn.classList.toggle('active');
  const val = btn.classList.contains('active') ? 1 : -1;
  try { await updateDoc(doc(db, coll, id), { [field]: increment(val) }); } catch (e) {}
};

// ===== –£–î–ê–õ–ï–ù–ò–ï –ü–û–°–¢–ê =====
window.deletePost = async (coll, id) => {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é?')) return;
  try {
    await deleteDoc(doc(db, coll, id));
    postStore.delete(coll + '_' + id);
    showToast('ok', '‚úÖ –£–¥–∞–ª–µ–Ω–æ');
  } catch (e) { showToast('err', '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏'); }
};

// ===== –ú–û–ò –ü–£–ë–õ–ò–ö–ê–¶–ò–ò =====
async function loadMyPosts() {
  if (!currentUser) return;
  document.getElementById('myPostsLoader').style.display = 'block';
  document.getElementById('myPostsGrid').innerHTML = '';
  document.getElementById('myPostsEmpty').style.display = 'none';

  try {
    const [mktSnap, jobSnap] = await Promise.all([
      getDocs(query(collection(db, 'market'), where('authorId', '==', currentUser.uid), orderBy('date', 'desc'))),
      getDocs(query(collection(db, 'jobs'), where('authorId', '==', currentUser.uid), orderBy('date', 'desc')))
    ]);

    const myItems = [
      ...mktSnap.docs.map(d => ({ id: d.id, type: 'market', ...d.data() })),
      ...jobSnap.docs.map(d => ({ id: d.id, type: 'jobs', ...d.data() }))
    ];

    document.getElementById('myPostsLoader').style.display = 'none';

    if (!myItems.length) {
      document.getElementById('myPostsEmpty').style.display = 'block'; return;
    }

    const typeLabel = { market: 'üõçÔ∏è –†—ã–Ω–æ–∫', jobs: 'üíº –í–∞–∫–∞–Ω—Å–∏—è' };
    document.getElementById('myPostsGrid').innerHTML = myItems.map(p => `
      <div class="my-post-card">
        <button class="my-post-del" onclick="deletePost('${p.type}','${p.id}')" title="–£–¥–∞–ª–∏—Ç—å">
          <i class="fas fa-trash"></i>
        </button>
        <div class="my-post-card-type">${typeLabel[p.type] || ''}</div>
        <div class="my-post-card-title">${escHtml(p.title)}</div>
        <div style="font-size:.78rem;color:var(--text2)">${p.date?.toDate ? fmtDate(p.date.toDate()) : ''}</div>
      </div>`).join('');
  } catch (e) {
    document.getElementById('myPostsLoader').style.display = 'none';
    showToast('err', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–π');
  }
}

// ===== –ß–ê–¢ =====
function showChat() {
  if (!currentUser) {
    document.getElementById('chatAuth').style.display = 'flex';
    document.getElementById('chatLayout').style.display = 'none';
    return;
  }
  document.getElementById('chatAuth').style.display = 'none';
  document.getElementById('chatLayout').style.display = 'grid';
  loadChatList();
}

function loadChatList() {
  const q1 = query(
    collection(db, 'chats'),
    where('participants', 'array-contains', currentUser.uid),
    orderBy('lastTime', 'desc')
  );
  onSnapshot(q1, async snap => {
    const list = document.getElementById('chatListItems');
    if (!snap.docs.length) {
      list.innerHTML = '<div style="padding:14px;font-size:.85rem;color:var(--text2);text-align:center">–ß–∞—Ç–æ–≤ –Ω–µ—Ç</div>';
      return;
    }
    let html = '';
    for (const d of snap.docs) {
      const data = d.data();
      const otherId = data.participants.find(id => id !== currentUser.uid);
      try {
        const otherSnap = await getDoc(doc(db, 'users', otherId));
        const other = otherSnap.data() || {};
        const ava = other.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(other.name || '?')}&background=e2e8f0&color=64748b`;
        const otherName = escHtml(other.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å');
        html += `<div class="chat-item" onclick="openChat('${d.id}','${otherId}','${(other.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å').replace(/'/g, "\\'")}','${ava}')">
          <img class="chat-item-ava" src="${ava}" alt="">
          <div class="chat-item-info">
            <div class="chat-item-name">${otherName}</div>
            <div class="chat-item-last">${escHtml(data.lastMsg || '')}</div>
          </div>
          <div class="chat-item-time">${data.lastTime?.toDate ? fmtTime(data.lastTime.toDate()) : ''}</div>
        </div>`;
      } catch (e) {}
    }
    list.innerHTML = html;
  });
}

window.startChatFromPost = async () => {
  if (!currentUser) { openModal('loginModal'); return; }
  if (!currentPostData?.authorId) return;
  closeModal('postModal');
  goTab('chat');
  const otherId = currentPostData.authorId;
  try {
    const otherSnap = await getDoc(doc(db, 'users', otherId));
    const other = otherSnap.data() || {};
    const ava = other.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(other.name || '?')}&background=e2e8f0&color=64748b`;
    const chatId = [currentUser.uid, otherId].sort().join('_');
    openChat(chatId, otherId, other.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', ava);
  } catch (e) { showToast('err', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —á–∞—Ç'); }
};

window.openChat = async (chatId, otherId, otherName, otherAva) => {
  // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —á–∞—Ç–∞
  if (chatMsgUnsub) { chatMsgUnsub(); chatMsgUnsub = null; }

  activeChatUserId = otherId;
  document.getElementById('chatEmpty').style.display = 'none';
  const chatActive = document.getElementById('chatActive');
  chatActive.style.display = 'flex';

  const avaEl = document.getElementById('chatWinAva');
  avaEl.style.backgroundImage = `url(${otherAva})`;
  avaEl.style.backgroundSize = 'cover';
  avaEl.style.backgroundPosition = 'center';
  document.getElementById('chatWinName').textContent = otherName;

  const chatRef = doc(db, 'chats', chatId);
  await setDoc(chatRef, {
    participants: [currentUser.uid, otherId],
    lastMsg: '',
    lastTime: serverTimestamp()
  }, { merge: true });

  const msgsQ = query(collection(db, 'chats', chatId, 'messages'), orderBy('time', 'asc'));
  chatMsgUnsub = onSnapshot(msgsQ, snap => {
    const msgsEl = document.getElementById('chatMessages');
    msgsEl.innerHTML = snap.docs.map(d => {
      const m = d.data();
      const mine = m.senderId === currentUser.uid;
      if (m.img) return `<div class="msg ${mine ? 'mine' : 'other'}">
        <img class="msg-img" src="${m.img}" onclick="window.open('${m.img}','_blank')" alt="">
        <div class="msg-time">${m.time?.toDate ? fmtTime(m.time.toDate()) : ''}</div>
      </div>`;
      return `<div class="msg ${mine ? 'mine' : 'other'}">
        <div class="msg-bubble">${escHtml(m.text)}</div>
        <div class="msg-time">${m.time?.toDate ? fmtTime(m.time.toDate()) : ''}</div>
      </div>`;
    }).join('');
    msgsEl.scrollTop = msgsEl.scrollHeight;
  });
  window._activeChatId = chatId;
};

window.sendMsg = async () => {
  if (!currentUser || !window._activeChatId) return;
  const input = document.getElementById('msgInput');
  const text = input.value.trim();
  if (!text) return;
  input.value = '';
  const chatId = window._activeChatId;
  await addDoc(collection(db, 'chats', chatId, 'messages'), {
    text, senderId: currentUser.uid, time: serverTimestamp()
  });
  await updateDoc(doc(db, 'chats', chatId), { lastMsg: text, lastTime: serverTimestamp() });
};

window.sendImg = async (e) => {
  if (!currentUser || !window._activeChatId) return;
  const file = e.target.files[0];
  if (!file) return;
  showToast('warn', '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ...');
  try {
    const img = await uploadToCloudinary(file);
    const chatId = window._activeChatId;
    await addDoc(collection(db, 'chats', chatId, 'messages'), {
      img, senderId: currentUser.uid, time: serverTimestamp()
    });
    await updateDoc(doc(db, 'chats', chatId), { lastMsg: 'üì∑ –§–æ—Ç–æ', lastTime: serverTimestamp() });
    showToast('ok', '‚úÖ –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
  } catch (err) { showToast('err', '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ'); }
  e.target.value = '';
};

// ===== –ü–†–û–§–ò–õ–¨ =====
window.switchProfileTab = (tab, btnEl) => {
  document.querySelectorAll('.profile-tab').forEach(b => b.classList.remove('on'));
  btnEl.classList.add('on');
  document.getElementById('profileMyPosts').style.display = tab === 'myPosts' ? 'block' : 'none';
  document.getElementById('profileSettings').style.display = tab === 'settings' ? 'block' : 'none';
  if (tab === 'myPosts') loadMyPosts();
};

window.saveSettings = async () => {
  if (!currentUser) return;
  const name = document.getElementById('settingsName').value.trim();
  const surname = document.getElementById('settingsSurname').value.trim();
  const pass = document.getElementById('settingsPass').value;
  try {
    const fullName = name + (surname ? ' ' + surname : '');
    if (fullName) await updateProfile(currentUser, { displayName: fullName });
    if (pass && pass.length >= 6) await updatePassword(currentUser, pass);
    await updateDoc(doc(db, 'users', currentUser.uid), { name, surname });
    updateProfileUI();
    document.getElementById('userAvaBtn').src = currentUser.photoURL ||
      `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=2563eb&color=fff`;
    showToast('ok', '‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
  } catch (e) { showToast('err', '–û—à–∏–±–∫–∞: ' + e.message); }
};

// ===== FAB ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ —Å —è–∑—ã–∫–æ–º =====
window.handleFab = () => {
  if (!currentUser) { openModal('loginModal'); return; }
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∫–ª–∞–¥–∫—É –ø–æ data-tab, –∞ –Ω–µ –ø–æ —Ç–µ–∫—Å—Ç—É
  const activeTab = document.querySelector('.nav-tab.on')?.dataset.tab;
  if (activeTab === 'market') openModal('addMarketModal');
  else if (activeTab === 'jobs') openModal('addJobModal');
  else if (activeTab === 'news' && currentUser.uid === ADMIN_UID) openModal('addNewsModal');
  else if (activeTab === 'news') showToast('warn', '‚ö†Ô∏è –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç–∏');
  else showToast('warn', '‚ö†Ô∏è –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –†—ã–Ω–æ–∫ –∏–ª–∏ –í–∞–∫–∞–Ω—Å–∏–∏');
};

// ===== 3 –¢–û–ß–ö–ò =====
window.toggleDropdown = (id, e) => {
  e.stopPropagation();
  document.querySelectorAll('.dropdown.show').forEach(d => { if (d.id !== id) d.classList.remove('show'); });
  document.getElementById(id)?.classList.toggle('show');
};
document.addEventListener('click', () => document.querySelectorAll('.dropdown.show').forEach(d => d.classList.remove('show')));

window.sharePost = (id) => {
  const url = `${location.origin}${location.pathname}?post=${id}`;
  if (navigator.share) {
    navigator.share({ title: '–ù–æ–æ–∫–∞—Ç –ù–æ–≤–æ—Å—Ç–∏', url });
  } else {
    navigator.clipboard.writeText(url).then(() => showToast('ok', 'üîó –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞'));
  }
};

window.reportPost = (id) => {
  showToast('ok', '‚ö†Ô∏è –ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –°–ø–∞—Å–∏–±–æ!');
};

// ===== –ü–†–ï–î–ü–†–û–°–ú–û–¢–† –§–ê–ô–õ–û–í =====
window.previewFile = (e, previewId) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    const img = document.getElementById(previewId);
    img.src = ev.target.result;
    img.style.display = 'block';
  };
  reader.readAsDataURL(file);
};

window.previewRegAva = (e) => {
  avatarFile = e.target.files[0];
  if (!avatarFile) return;
  const reader = new FileReader();
  reader.onload = ev => document.getElementById('regAvaPreview').src = ev.target.result;
  reader.readAsDataURL(avatarFile);
};

// ===== –°–ò–õ–ê –ü–ê–†–û–õ–Ø =====
window.checkStrength = (pass) => {
  const fill = document.getElementById('strengthFill');
  const text = document.getElementById('strengthText');
  let score = 0;
  if (pass.length >= 6) score++;
  if (pass.length >= 10) score++;
  if (/[A-Z]/.test(pass)) score++;
  if (/[0-9]/.test(pass)) score++;
  if (/[^A-Za-z0-9]/.test(pass)) score++;
  const colors = ['#ef4444', '#f97316', '#eab308', '#22c55e', '#10b981'];
  const labels = ['–û—á–µ–Ω—å —Å–ª–∞–±—ã–π', '–°–ª–∞–±—ã–π', '–°—Ä–µ–¥–Ω–∏–π', '–°–∏–ª—å–Ω—ã–π', '–û—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π'];
  fill.style.width = (score * 20) + '%';
  fill.style.background = colors[score - 1] || '#ef4444';
  text.textContent = score > 0 ? labels[score - 1] : '';
};

// ===== –Ø–ó–´–ö =====
document.querySelectorAll('.lang-sw button').forEach(btn => {
  btn.addEventListener('click', function () {
    document.querySelectorAll('.lang-sw button').forEach(b => b.classList.remove('on'));
    this.classList.add('on');
    const lang = this.dataset.lang;
    document.querySelectorAll('[data-ru]').forEach(el => {
      el.textContent = el.getAttribute('data-' + lang) || el.textContent;
    });
    localStorage.setItem('lang', lang);
  });
});
if (localStorage.getItem('lang') === 'kg') {
  document.querySelectorAll('.lang-sw button').forEach(b => b.classList.toggle('on', b.dataset.lang === 'kg'));
  document.querySelectorAll('[data-ru]').forEach(el => {
    el.textContent = el.getAttribute('data-kg') || el.textContent;
  });
}

// ===== –¢–ï–ú–ê =====
window.toggleTheme = () => {
  document.body.classList.toggle('dark');
  const dark = document.body.classList.contains('dark');
  document.getElementById('themeBtn').textContent = dark ? '‚òÄÔ∏è' : 'üåô';
  localStorage.setItem('theme', dark ? 'dark' : 'light');
};
if (localStorage.getItem('theme') === 'dark') {
  document.body.classList.add('dark');
  document.getElementById('themeBtn').textContent = '‚òÄÔ∏è';
}

// ===== –¢–ê–ë–´ =====
window.goTab = (name) => {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('on'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('on'));
  const sec = document.getElementById('sec-' + name);
  if (sec) sec.classList.add('on');
  const activeTabBtn = document.querySelector(`.nav-tab[data-tab="${name}"]`);
  if (activeTabBtn) activeTabBtn.classList.add('on');
  if (name === 'chat') showChat();
  if (name === 'profile') {
    document.getElementById('sec-profile').classList.add('on');
    loadMyPosts();
  }
  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∏—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
  if (name === 'news') document.getElementById('newsSearch').value = '';
  if (name === 'market') document.getElementById('marketSearch').value = '';
  if (name === 'jobs') document.getElementById('jobsSearch').value = '';
};

// ===== –ú–û–î–ê–õ–ö–ò =====
window.openModal = (id) => document.getElementById(id)?.classList.add('show');
window.closeModal = (id) => document.getElementById(id)?.classList.remove('show');
document.querySelectorAll('.overlay').forEach(o => {
  o.addEventListener('click', e => { if (e.target === o) o.classList.remove('show'); });
});

// ===== –†–´–ù–û–ö –ö–ê–¢–ï–ì–û–†–ò–ò =====
document.querySelectorAll('.cat-btn').forEach(btn => {
  btn.addEventListener('click', function () {
    document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('on'));
    this.classList.add('on');
    currentMarketCat = this.dataset.cat;
    filterMarket();
  });
});

// ===== –°–ö–†–û–õ–õ =====
window.addEventListener('scroll', () => {
  document.getElementById('scrollUp').classList.toggle('show', window.pageYOffset > 300);
});

// ===== HELPERS =====
function fmtDate(d) {
  const now = new Date();
  const diff = now - d;
  if (diff < 60000) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
  if (diff < 3600000) return Math.floor(diff / 60000) + ' –º–∏–Ω –Ω–∞–∑–∞–¥';
  if (diff < 86400000) return Math.floor(diff / 3600000) + ' —á –Ω–∞–∑–∞–¥';
  if (diff < 604800000) return Math.floor(diff / 86400000) + ' –¥ –Ω–∞–∑–∞–¥';
  return d.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
}
function fmtTime(d) { return d.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }); }
function fmtPrice(p) { return Number(p).toLocaleString('ru-RU') + ' —Å–æ–º'; }
function showErr(el, msg) { el.textContent = msg; el.style.display = 'block'; }
function escHtml(str) {
  return String(str || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}
function firebaseError(code) {
  const map = {
    'auth/email-already-in-use': 'Email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è',
    'auth/invalid-email': '–ù–µ–≤–µ—Ä–Ω—ã–π email',
    'auth/wrong-password': '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å',
    'auth/user-not-found': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω',
    'auth/weak-password': '–°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)',
    'auth/too-many-requests': '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ',
    'auth/invalid-credential': '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å'
  };
  return map[code] || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞';
}
window.showToast = (type, text) => {
  const t = document.getElementById('toast');
  t.className = 'toast ' + type + ' show';
  t.innerHTML = `<span>${type === 'ok' ? '‚úÖ' : type === 'err' ? '‚ùå' : '‚ö†Ô∏è'}</span><span>${text}</span>`;
  clearTimeout(window._toastTimer);
  window._toastTimer = setTimeout(() => t.classList.remove('show'), 3500);
};

// –ú–æ–±–∏–ª—å–Ω—ã–π —á–∞—Ç ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
window.showChatList = () => {
  document.getElementById('chatListPanel').classList.remove('hidden-mobile');
  document.querySelector('.chat-window').classList.add('hidden-mobile');
  document.getElementById('chatBackBtn').style.display = 'none';
};

// –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç –Ω–∞ –º–æ–±–∏–ª–µ
const _origOpenChat = window.openChat;
window.openChat = async (...args) => {
  await _origOpenChat(...args);
  if(window.innerWidth <= 768){
    document.getElementById('chatListPanel').classList.add('hidden-mobile');
    document.querySelector('.chat-window').classList.remove('hidden-mobile');
    document.getElementById('chatBackBtn').style.display = 'flex';
  }
}; 
</script>
</body>
</html>
